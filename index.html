<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>BuzzPi ‚Äî Demo (Billionaire FX)</title>
<meta name="theme-color" content="#0b0b0f" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<style>
  :root{--bg:#fff;--fg:#0e0e12;--muted:#68707a;--card:#f7f8fa;--gold:#f7c948;--gold2:#e8b12e;--accent:#7b5df9;--ring:0 6px 18px rgba(0,0,0,.12)}
  @media (prefers-color-scheme: dark){:root{--bg:#0b0b0f;--fg:#eef0f3;--muted:#98a0aa;--card:#111318;--ring:0 8px 24px rgba(0,0,0,.45)}}
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .app{max-width:800px;margin:0 auto;padding-bottom:96px}
  header{position:sticky;top:0;z-index:30;background:var(--bg);padding:12px 16px;border-bottom:1px solid rgba(127,127,127,.15)}
  .row{display:flex;gap:12px;align-items:center;justify-content:space-between}
  .logo{display:flex;gap:10px;align-items:center;font-weight:800}
  .logo-badge{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--gold),var(--gold2));box-shadow:var(--ring)}
  .tabs{display:flex;gap:8px;overflow:auto;padding:10px 16px}
  .chip{flex:0 0 auto;padding:8px 12px;border-radius:999px;background:var(--card);font-weight:600;color:var(--muted)}
  .chip.active{background:linear-gradient(135deg,#5b35f6,#7b5df9);color:#fff}
  .screen{display:none;padding:12px 16px}.screen.active{display:block}

  .card{background:var(--card);border-radius:16px;padding:16px;box-shadow:var(--ring);margin-bottom:14px}
  .coins{font-size:28px;font-weight:800}
  .muted{color:var(--muted);font-size:13px}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;background:linear-gradient(135deg,#5b35f6,#7b5df9);color:#fff;border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;min-height:44px}
  .btn.gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:#212121}
  .btn.secondary{background:linear-gradient(135deg,#222,#333)}
  .btn.small{font-size:12px;padding:10px 12px}
  .rowBtns{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .rowBtns.onecol{grid-template-columns:1fr}
  .small{font-size:12px}
  .bar{height:10px;background:#1f2330;border-radius:999px;overflow:hidden}
  .bar>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#5b35f6,#7b5df9)}

  .gsec{margin:18px 0}
  .gtitle{display:flex;align-items:center;gap:10px;margin:6px 0 10px}
  .gtitle span{font-weight:800}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  @media (max-width:520px){.grid{grid-template-columns:repeat(3,1fr)}}
  .gift{background:var(--card);border-radius:14px;padding:10px;text-align:center;cursor:pointer;user-select:none;position:relative;box-shadow:var(--ring);transition:.2s}
  .gift .emo{font-size:26px;line-height:1}
  .gift .name{font-size:11px;color:var(--muted);margin-top:4px}
  .gift .price{font-size:12px;font-weight:800;margin-top:4px}
  .gift:active{transform:scale(.98)}
  .gift[data-tier="billionaire"]{outline:2px solid rgba(247,201,72,.25)}
  .gift[data-tier="rare"]{outline:2px solid rgba(91,53,246,.25)}

  /* selection heartbeat */
  .gift.highlight::after{content:"";position:absolute;inset:-2px;border-radius:16px;box-shadow:0 0 0 0 rgba(123,93,249,.5);animation:heartbeat 1200ms ease-in-out infinite}
  @keyframes heartbeat{0%{transform:scale(1);box-shadow:0 0 0 0 rgba(123,93,249,.45)}25%{transform:scale(1.02);box-shadow:0 0 0 8px rgba(123,93,249,.15)}50%{transform:scale(1);box-shadow:0 0 0 0 rgba(123,93,249,0)}75%{transform:scale(1.02);box-shadow:0 0 0 8px rgba(123,93,249,.12)}100%{transform:scale(1);box-shadow:0 0 0 0 rgba(123,93,249,0)}}

  /* stage + combo */
  .stage{position:fixed;inset:0;pointer-events:none;display:flex;align-items:center;justify-content:center;overflow:hidden;z-index:20}
  .combo{position:fixed;top:18%;left:50%;transform:translateX(-50%);font-weight:900;font-size:28px;background:linear-gradient(135deg,#5b35f6,#7b5df9);color:#fff;padding:6px 12px;border-radius:12px;box-shadow:var(--ring);opacity:0;animation:combo .3s ease forwards}
  @keyframes combo{to{opacity:1;transform:translateX(-50%) scale(1.05)}}

  /* generic particles for non-billionaire fallbacks */
  .pop{position:absolute;font-size:64px;animation:pop .6s ease-out forwards}
  @keyframes pop{0%{transform:scale(.5);opacity:.0}40%{transform:scale(1.1);opacity:1}100%{transform:scale(1) translateY(-120px);opacity:0}}
  .spark{position:absolute;width:6px;height:6px;border-radius:50%;background:radial-gradient(circle,#fff,#ffd);animation:spark 800ms ease-out forwards}
  @keyframes spark{from{transform:translate(0,0);opacity:1}to{transform:translate(var(--dx),var(--dy));opacity:0}}

  /* Rare + Common alive anims (kept lightweight) */
  .bfly{position:absolute;width:64px;height:64px;transform-origin:center;animation:bfFloat 1s ease-in-out forwards}
  .bf-body{position:absolute;left:30px;top:20px;width:6px;height:24px;background:#3b2a22;border-radius:6px}
  .wing{position:absolute;width:28px;height:28px;border-radius:50% 45% 50% 45%;background:radial-gradient(circle at 30% 30%,#ffb6c1,#ff69b4);opacity:.95;transform-origin:28px 14px;filter:drop-shadow(0 2px 6px rgba(0,0,0,.25))}
  .wing.left{left:10px;top:12px;transform:rotateZ(12deg);animation:flap .25s ease-in-out infinite alternate}
  .wing.right{left:28px;top:12px;transform:scaleX(-1) rotateZ(12deg);animation:flap .25s ease-in-out infinite alternate}
  @keyframes flap{from{transform:rotateZ(6deg)}to{transform:rotateZ(26deg)}}
  @keyframes bfFloat{0%{transform:translate(-20px,40px) rotate(-8deg);opacity:0}20%{opacity:1}50%{transform:translate(0px,-10px) rotate(5deg)}100%{transform:translate(120px,-60px) rotate(12deg);opacity:0}}

  /* Cars etc (unchanged) */
  .car{position:absolute;width:120px;height:52px;transform-origin:center;animation:carEnter .45s ease-out forwards,carExit .6s ease-in forwards .6s}
  .car-body{position:absolute;left:10px;right:10px;top:10px;bottom:10px;border-radius:12px;background:linear-gradient(135deg,#18a558,#0b7a44);box-shadow:0 6px 12px rgba(0,0,0,.3)}
  .wheel{position:absolute;bottom:2px;width:22px;height:22px;border-radius:50%;background:radial-gradient(circle at 35% 35%,#000,#222);border:3px solid #444;animation:spin .5s linear infinite}
  .wheel::after{content:"";position:absolute;left:50%;top:50%;width:8px;height:8px;transform:translate(-50%,-50%);background:#888;border-radius:50%}
  .wheel.l{left:14px}.wheel.r{right:14px}
  @keyframes carEnter{from{transform:translateX(-160px) rotate(-12deg)}to{transform:translateX(0) rotate(-2deg)}}
  @keyframes carExit{to{transform:translateX(240px) rotate(3deg);opacity:0}}
  @keyframes spin{to{transform:rotate(360deg)}}
  .smoke{position:absolute;bottom:8px;left:2px;width:10px;height:10px;border-radius:50%;background:radial-gradient(circle,#fff,#bbb0);filter:blur(1px);animation:puff .6s ease-out forwards}
  @keyframes puff{to{transform:translate(-24px,-10px) scale(1.8);opacity:0}}

  .petal{position:absolute;width:10px;height:14px;background:radial-gradient(circle at 30% 30%,#ff8aa1,#e6406f);border-radius:10px 10px 2px 10px;transform:rotate(20deg);opacity:.95;animation:fall 900ms ease-in forwards}
  @keyframes fall{from{transform:translateY(-20px) rotate(20deg)}to{transform:translateY(120px) rotate(60deg);opacity:0}}

  .bubble{position:absolute;width:8px;height:8px;border-radius:50%;background:radial-gradient(circle,#fff,#fff0);border:1px solid #fff8;animation:rise 900ms ease-out forwards}
  @keyframes rise{from{transform:translateY(0) scale(.6);opacity:.8}to{transform:translateY(-120px) scale(1.1);opacity:0}}

  .clink{position:absolute;width:16px;height:16px;border-radius:50%;border:2px solid #fff8;animation:clinkPop 500ms ease-out forwards}
  @keyframes clinkPop{from{transform:scale(.4);opacity:.8}to{transform:scale(1.6);opacity:0}}

  .shock{position:absolute;width:2px;height:14px;background:#fff8;animation:shockOut 400ms ease-out forwards}
  @keyframes shockOut{from{transform:scaleY(.4);opacity:.9}to{transform:scaleY(1.4) translateY(-14px);opacity:0}}

  .kiss{position:absolute;font-size:42px;animation:kissUp 800ms ease-out forwards}
  @keyframes kissUp{from{transform:translateY(20px);opacity:.2}to{transform:translateY(-80px);opacity:0}}

  .coin{position:absolute;width:14px;height:14px;border-radius:50%;background:radial-gradient(circle,#ffd54f,#fbc02d);box-shadow:0 1px 2px rgba(0,0,0,.25);animation:coinFall 900ms ease-in forwards}
  @keyframes coinFall{from{transform:translateY(-40px) rotate(0)}to{transform:translateY(120px) rotate(360deg);opacity:0}}

  .nav{position:fixed;bottom:0;left:0;right:0;background:var(--bg);border-top:1px solid rgba(127,127,127,.15);display:flex;justify-content:space-around;align-items:center;padding:10px 8px 14px;z-index:30}
  .nav .item{display:flex;flex-direction:column;align-items:center;font-size:11px;color:var(--muted);text-decoration:none}
  .honeypot{position:relative;top:-22px;width:68px;height:68px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff8,transparent),linear-gradient(135deg,#fce38a,#f38181);box-shadow:0 10px 30px rgba(243,129,129,.35), inset 0 0 0 4px rgba(255,255,255,.35);display:flex;align-items:center;justify-content:center;border:0}
  .honeypot:after{content:"üçØ";font-size:28px}
  .honeypot:active{transform:scale(.97)}

  .toast{position:fixed;bottom:92px;left:50%;transform:translateX(-50%);background:#111c;border:1px solid #fff2;color:#fff;padding:10px 14px;border-radius:10px;backdrop-filter:blur(8px);font-size:13px;opacity:0;transition:.25s;z-index:40}
  .toast.show{opacity:1}

  .err{position:fixed;top:8px;left:50%;transform:translateX(-50%);background:#ff3b30cc;color:#fff;padding:8px 12px;border-radius:10px;font-size:12px;z-index:50;display:none}
  .footerNote{opacity:.6;text-align:center;font-size:11px;margin:20px 0}
</style>
</head>
<body>
<div class="err" id="err"></div>

<div class="app">
  <header>
    <div class="row">
      <div class="logo"><div class="logo-badge"></div> BuzzPi</div>
      <div class="coins" id="balance" title="Triple-tap: +100 ‚Ä¢ Long-press: +500">0</div>
    </div>
    <div class="tabs" id="topTabs">
      <div class="chip active">Following</div><div class="chip">Popular</div>
      <div class="chip">Nearby</div><div class="chip">Newcomers</div><div class="chip">Trending</div>
    </div>
  </header>

  <section class="screen active" id="scrHome">
    <div class="card"><div class="row">
      <div>
        <div style="font-weight:800">Welcome to BuzzPi (Demo)</div>
        <div class="muted">Tap the Gifts tab to try <b>alive</b> animations & coin flow.</div>
      </div>
      <div class="muted small">Theme-adaptive ‚úì</div>
    </div></div>
  </section>

  <section class="screen" id="scrGifts">
    <div class="gsec"><div class="gtitle"><span>Common</span><small class="muted">1‚Äì20 BuzzCoins</small></div><div class="grid" id="gridCommon"></div></div>
    <div class="gsec"><div class="gtitle"><span>Rare</span><small class="muted">50‚Äì500 BuzzCoins</small></div><div class="grid" id="gridRare"></div></div>
    <div class="gsec"><div class="gtitle"><span>Billionaire</span><small class="muted">1,000‚Äì10,000 BuzzCoins</small></div><div class="grid" id="gridBillion"></div></div>
  </section>

  <section class="screen" id="scrWallet">
    <div class="card">
      <div class="coins"><span id="cRegular">0</span> <span class="muted">BuzzCoins</span></div>
      <div class="muted">Ad-earned balance: <b id="cAd">0</b> (gifting only)</div>
      <div class="muted small" id="adInfo"></div>
      <div class="rowBtns" style="margin-top:12px">
        <button class="btn gold" id="btnTopup">Top up +100</button>
        <button class="btn" id="btnWatchAd">Watch Ad (+1)</button>
      </div>
      <div class="rowBtns onecol" style="margin-top:8px">
        <button class="btn secondary small" id="btnReset">Reset demo</button>
      </div>
      <div class="muted small" style="margin-top:8px">Ad limit: 5/day ‚Ä¢ 5s cooldown ‚Ä¢ Tip: triple-tap balance for +100, long-press for +500</div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div style="font-weight:800">Level <span id="level">1</span></div>
          <div class="muted">Spend 500 coins on gifts to level up</div>
        </div>
        <div class="muted small">Progress: <b id="lvPct">0%</b></div>
      </div>
      <div class="bar" style="margin-top:12px"><i id="lvBar"></i></div>
      <div class="muted small" id="lvHint" style="margin-top:8px"></div>
    </div>
  </section>

  <section class="screen" id="scrProfile">
    <div class="card"><div style="display:flex;gap:12px;align-items:center">
      <div class="logo-badge" style="width:44px;height:44px;border-radius:12px"></div>
      <div><div style="font-weight:800">You (Demo)</div><div class="muted small">Ranked badge & frames appear here later.</div></div>
    </div></div>
    <div class="card"><div style="font-weight:800;margin-bottom:8px">Stealth Mode (Phase 2)</div>
      <div class="muted small">Face mask + voice modulation will be here in Phase 2.</div>
    </div>
  </section>

  <div class="footerNote">If anything looks cached, reload with <code>?v=6</code>.</div>
</div>

<!-- Stage for DOM-based anims -->
<div class="stage" id="stage"></div>
<!-- Canvas FX layer (created on demand) -->
<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;z-index:25;display:none;"></canvas>

<div class="toast" id="toast"></div>

<script>
/* ====== Safety & helpers ====== */
function $(s){return document.querySelector(s)}
function el(tag,cls){const d=document.createElement(tag); if(cls) d.className=cls; return d}
function showToast(msg,ms=1400){const t=$('#toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),ms)}
function showErr(msg){const e=$('#err'); e.textContent=msg; e.style.display='block'; setTimeout(()=>e.style.display='none',4000)}
window.onerror=(m,src,l,c,e)=>showErr('JS error: '+(e?.message||m));
window.onunhandledrejection=(ev)=>showErr('Promise error: '+(ev?.reason?.message||ev?.reason||'unknown'));

/* ====== State & persistence ====== */
const S={regular:300,ad:0,spent:0,adsToday:0,lastAdDate:null,holdTimer:null};
function save(){localStorage.setItem('buzz_demo_bfx',JSON.stringify(S))}
function load(){try{Object.assign(S,JSON.parse(localStorage.getItem('buzz_demo_bfx')||'{}'))}catch(_){}}

/* ====== UI ====== */
const EL={
  screens:{home:$('#scrHome'),gifts:$('#scrGifts'),wallet:$('#scrWallet'),profile:$('#scrProfile')},
  balance:$('#balance'), cRegular:$('#cRegular'), cAd:$('#cAd'),
  adInfo:$('#adInfo'), level:$('#level'), lvBar:$('#lvBar'), lvPct:$('#lvPct'), lvHint:$('#lvHint'),
  gridCommon:$('#gridCommon'),gridRare:$('#gridRare'),gridBillion:$('#gridBillion'),
  stage:$('#stage'), btnTopup:$('#btnTopup'), btnWatchAd:$('#btnWatchAd'), btnReset:$('#btnReset'),
  fx:$('#fx')
};
function fmt(n){return n.toLocaleString()}
function updateUI(){
  $('#balance').textContent=fmt(S.regular+S.ad);
  $('#cRegular').textContent=fmt(S.regular);
  $('#cAd').textContent=fmt(S.ad);
  const today=new Date().toISOString().slice(0,10);
  if(S.lastAdDate!==today){S.adsToday=0;S.lastAdDate=today;save()}
  $('#adInfo').textContent=`Ads watched today: ${S.adsToday}/5`;
  const per=500, lvl=Math.min(99,Math.floor(S.spent/per)+1), into=S.spent%per, pct=Math.round(into/per*100);
  $('#level').textContent=lvl; $('#lvPct').textContent=pct+'%'; $('#lvBar').style.width=pct+'%';
  $('#lvHint').textContent=`${fmt(per-into)} coins to Level ${Math.min(99,lvl+1)}`;
}
function spend(amount){
  if(amount>S.regular+S.ad) return false;
  const useAd=Math.min(S.ad,amount); S.ad-=useAd; S.regular-=(amount-useAd); S.spent+=amount; save(); updateUI(); return true;
}

/* ====== Gifts data ====== */
const gifts={
  common:[
    {emoji:'ü•≥',name:'Party',price:1,anim:'party'},{emoji:'ü•∞',name:'Hearts',price:1,anim:'sparkle'},
    {emoji:'üòç',name:'Love Eyes',price:1,anim:'sparkle'},{emoji:'üòã',name:'Yum',price:1,anim:'lick'},
    {emoji:'ü§ó',name:'Hug',price:1,anim:'sparkle'},{emoji:'ü§©',name:'Starry',price:1,anim:'sparkle'},
    {emoji:'ü§ë',name:'Cashy',price:1,anim:'coins'},{emoji:'üç≠',name:'Lollipop',price:2,anim:'sparkle'},
    {emoji:'üç¨',name:'Candy',price:2,anim:'sparkle'},{emoji:'üç´',name:'Chocolate',price:2,anim:'sparkle'},
    {emoji:'üç∏',name:'Cocktail',price:5,anim:'sparkle'},{emoji:'üçé',name:'Apple',price:5,anim:'sparkle'},
    {emoji:'üç∫',name:'Beer',price:5,anim:'sparkle'},{emoji:'üåπ',name:'Rose',price:10,anim:'rose'},
    {emoji:'üå∏',name:'Blossom',price:10,anim:'rose'},{emoji:'‚ú®',name:'Sparkle',price:10,anim:'sparkle'},
    {emoji:'üíê',name:'Bouquet',price:20,anim:'rose'},{emoji:'üçª',name:'Cheers',price:20,anim:'clink'},
    {emoji:'üëè',name:'Clap',price:20,anim:'clap'},{emoji:'üíã',name:'Kiss',price:20,anim:'kiss'}
  ],
  rare:[
    {emoji:'ü¶ã',name:'Butterfly',price:50,anim:'butterfly'},{emoji:'üå©',name:'Storm',price:50,anim:'storm'},
    {emoji:'üå§',name:'Sunrise',price:50,anim:'sun'},{emoji:'üåà',name:'Rainbow',price:50,anim:'rainbow'},
    {emoji:'‚ùÑÔ∏è',name:'Snow',price:50,anim:'snow'},{emoji:'üß∏',name:'Teddy',price:100,anim:'sparkle'},
    {emoji:'üêá',name:'Bunny',price:100,anim:'sparkle'},{emoji:'üçæ',name:'Champagne',price:100,anim:'champagne'},
    {emoji:'üëë',name:'Crown',price:100,anim:'crown'},{emoji:'üç∑',name:'Wine',price:100,anim:'sparkle'},
    {emoji:'ü•Ç',name:'Toast',price:100,anim:'clink'},{emoji:'üèéÔ∏è',name:'Jade Lamborghini',price:500,anim:'car'},
    {emoji:'‚úàÔ∏è',name:'Crystal Aeroplane',price:500,anim:'planeSimple'},{emoji:'üöô',name:'Golden Hummer',price:500,anim:'car'},
    {emoji:'üõ•Ô∏è',name:'Yacht',price:500,anim:'yacht'}
  ],
  billionaire:[
    {emoji:'üî•üïäÔ∏è',name:'Fiery Phoenix',price:1000,anim:'phoenixFX'},
    {emoji:'ü¶Ñ',name:'Racing Unicorn',price:1000,anim:'unicornFX'},
    {emoji:'üè∞',name:'Crystal Castle',price:1000,anim:'castleFX'},
    {emoji:'üí∞',name:'Treasure Chest',price:1000,anim:'chestFX'},
    {emoji:'üèØ‚òÅÔ∏è',name:'Mansion in the Sky',price:5000,anim:'castleFX'},
    {emoji:'üßú‚Äç‚ôÄÔ∏è',name:'Mermaid',price:5000,anim:'sparkle'},
    {emoji:'üíò',name:'Cupids',price:5000,anim:'sparkle'},
    {emoji:'üßù‚Äç‚ôÄÔ∏è',name:'Elf Queen',price:5000,anim:'sparkle'},
    {emoji:'üõ©Ô∏è‚ú®',name:'Golden Private Jet',price:10000,anim:'jetFX'},
    {emoji:'üíé‚åö',name:'Diamond Rolex',price:10000,anim:'rolexFX'},
    {emoji:'üêéüöó',name:'Chariots of Horses',price:10000,anim:'unicornFX'}
  ]
};

/* ====== Render gifts ====== */
function giftEl(g){const e=el('div','gift'); e.dataset.price=g.price; e.dataset.anim=g.anim||''; e.dataset.name=g.name; e.innerHTML=`<div class="emo">${g.emoji}</div><div class="name">${g.name}</div><div class="price">${fmt(g.price)}ü™ô</div>`; return e}
function mountGifts(){
  gifts.common.forEach(g=>EL.gridCommon.appendChild(giftEl(g)));
  gifts.rare.forEach(g=>{const e=giftEl(g); e.dataset.tier='rare'; EL.gridRare.appendChild(e)});
  gifts.billionaire.forEach(g=>{const e=giftEl(g); e.dataset.tier='billionaire'; EL.gridBillion.appendChild(e)});
}

/* ====== DOM (non-billionaire) anim helpers ====== */
function center(){return {x:innerWidth/2,y:innerHeight/2}}
function add(node,ms=1000){EL.stage.appendChild(node); setTimeout(()=>node.remove(),ms)}
function fallback(emoji){const p=el('div','pop');const {x,y}=center();p.textContent=emoji;p.style.left=(x-28)+'px';p.style.top=(y-28)+'px';EL.stage.appendChild(p);for(let i=0;i<10;i++){const s=el('div','spark');s.style.left=x+'px';s.style.top=y+'px';s.style.setProperty('--dx',((Math.random()*2-1)*140|0)+'px');s.style.setProperty('--dy',(-60-Math.random()*120|0)+'px');EL.stage.appendChild(s);setTimeout(()=>s.remove(),800)}setTimeout(()=>p.remove(),620)}
/* party, lick, butterfly, cars, rose, champagne, clink, clap, kiss, coins, sky, sun, crown, planeSimple, yacht */
function anim_party(){const box=el('div','party');const {x,y}=center();box.style.left=(x-60)+'px';box.style.top=(y-60)+'px';box.appendChild(el('div','horn'));for(let i=0;i<18;i++){const c=el('div','conf');c.style.left=(50+Math.random()*40-20)+'px';c.style.top=(40+Math.random()*10-5)+'px';c.style.background=['#f44336','#ff9800','#ffeb3b','#4caf50','#2196f3','#9c27b0'][i%6];c.style.animationDelay=(i*30)+'ms';box.appendChild(c)}add(box,1000)}
function anim_lick(){const b=el('div','lick');const {x,y}=center();b.style.left=(x-60)+'px';b.style.top=(y-60)+'px';const m=el('div','mouth');const t=el('div','tongue');m.appendChild(t);b.appendChild(m);add(b,900)}
function anim_butterfly(){const {x,y}=center();const r=el('div','bfly');r.style.left=(x-32)+'px';r.style.top=y+'px';r.innerHTML='<div class="bf-body"></div><div class="wing left"></div><div class="wing right"></div>';add(r,1000)}
function anim_car(){const {x,y}=center();const car=el('div','car');car.style.left=(x-60)+'px';car.style.top=y+'px';car.innerHTML='<div class="car-body"></div><div class="wheel l"></div><div class="wheel r"></div>';for(let i=0;i<3;i++){const s=el('div','smoke');s.style.left=(x-30)+'px';s.style.top=(y+20)+'px';s.style.animationDelay=(i*120)+'ms';add(s,600+i*120)}add(car,1400)}
function anim_rose(){const {x,y}=center();for(let i=0;i<12;i++){const p=el('div','petal');p.style.left=(x+(Math.random()*120-60))+'px';p.style.top=(y+(Math.random()*-30-10))+'px';p.style.animationDelay=(i*40)+'ms';add(p,1000+i*40)}}
function anim_champagne(){const {x,y}=center();for(let i=0;i<14;i++){const b=el('div','bubble');b.style.left=(x+(Math.random()*50-25))+'px';b.style.top=(y+20+(Math.random()*20-10))+'px';b.style.animationDelay=(i*40)+'ms';add(b,1000+i*40)}}
function anim_clink(){const {x,y}=center();for(let i=0;i<6;i++){const c=el('div','clink');c.style.left=(x+(Math.random()*30-15))+'px';c.style.top=(y-10)+'px';c.style.animationDelay=(i*50)+'ms';add(c,500+i*50)}}
function anim_clap(){const {x,y}=center();for(let i=0;i<6;i++){const s=el('div','shock');s.style.left=(x+(i*8-20))+'px';s.style.top=(y-6)+'px';add(s,420)}}
function anim_kiss(){const {x,y}=center();for(let i=0;i<6;i++){const k=el('div','kiss');k.textContent='üíã';k.style.left=(x+(Math.random()*40-20))+'px';k.style.top=(y+10)+'px';k.style.animationDelay=(i*60)+'ms';add(k,900+i*60)}}
function anim_coins(){const {x,y}=center();for(let i=0;i<20;i++){const c=el('div','coin');c.style.left=(x+(Math.random()*120-60))+'px';c.style.top=(y-40+(Math.random()*20-10))+'px';c.style.animationDelay=(i*30)+'ms';add(c,900+i*30)}}
function anim_storm(){add(el('div','flash'),180);const {x,y}=center();for(let i=0;i<3;i++){const b=el('div','bolt');b.style.left=(x+(i*16-24))+'px';b.style.top=(y-40)+'px';add(b,280)}}
function anim_rainbow(){const r=el('div','rainbow');const {x,y}=center();r.style.left=(x-110)+'px';r.style.top=(y-80)+'px';add(r,1200)}
function anim_snow(){const {x,y}=center();for(let i=0;i<14;i++){const f=el('div','flake');f.style.left=(x+(Math.random()*80-40))+'px';f.style.top=(y-40)+'px';add(f,1200)}}
function anim_sun(){const {x,y}=center();const s=el('div','sun');s.style.left=(x-40)+'px';s.style.top=(y-40)+'px';for(let i=0;i<12;i++){const r=el('div','ray');r.style.transform=`rotate(${i*30}deg)`;s.appendChild(r)}add(s,1000)}
function anim_crown(){const c=el('div','crown');const {x,y}=center();c.style.left=(x-45)+'px';c.style.top=(y-60)+'px';add(c,900)}
function anim_planeSimple(){const {x,y}=center();const p=el('div','plane');p.style.left=(x-60)+'px';p.style.top=y+'px';p.appendChild(el('div','trail'));add(p,1000)}
function anim_yacht(){const {x,y}=center();const yb=el('div','yacht');yb.style.left=(x-70)+'px';yb.style.top=y+'px';yb.appendChild(el('div','wave'));add(yb,1200)}

/* ====== Canvas FX (Billionaire) ====== */
function ensureFX(){
  const c=EL.fx; c.width=innerWidth*devicePixelRatio; c.height=innerHeight*devicePixelRatio;
  c.style.display='block'; const ctx=c.getContext('2d'); ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
  return {c,ctx,w:innerWidth,h:innerHeight};
}
function endFX(){ EL.fx.style.display='none'; const ctx=EL.fx.getContext('2d'); ctx.clearRect(0,0,EL.fx.width,EL.fx.height); }

/* tiny utils */
const R=()=>Math.random(); const PI=Math.PI; const TAU=Math.PI*2;
function lerp(a,b,t){return a+(b-a)*t}
function easeOutCubic(t){return 1-Math.pow(1-t,3)}
function easeInOut(t){return t<.5? 4*t*t*t : 1-Math.pow(-2*t+2,3)/2}
function blendAdd(ctx){ctx.globalCompositeOperation='lighter'}
function blendNorm(ctx){ctx.globalCompositeOperation='source-over'}
function shakeFrame(ctx, t, mag){ ctx.save(); const s=mag*Math.sin(t*40); ctx.translate(R()*s - s/2, R()*s - s/2) }
function shakeRestore(ctx){ ctx.restore() }

/* --- Phoenix (fire trail + glow + swoop + shake) --- */
function phoenixFX(){
  const {ctx,w,h}=ensureFX(); const start=performance.now(); const dur=1300;
  function flame(x,y,r,alpha){
    const g=ctx.createRadialGradient(x,y,0,x,y,r);
    g.addColorStop(0,`rgba(255,180,60,${alpha})`);
    g.addColorStop(.5,`rgba(255,90,20,${alpha*.9})`);
    g.addColorStop(1,`rgba(80,0,0,0)`);
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,r,0,TAU); ctx.fill();
  }
  (function loop(now){
    const t=Math.min(1,(now-start)/dur);
    ctx.clearRect(0,0,w,h);
    const p=easeInOut(t);
    const x=lerp(-w*0.2, w*1.1, p);
    const y=lerp(h*0.7,  h*0.2, p);
    blendAdd(ctx);
    // trail particles
    for(let i=0;i<140;i++){
      const b=R()*80+20;
      const a=(1-t)*(R()*0.5+0.3);
      const px=x - R()*160, py=y + R()*60 - 30;
      flame(px,py,b*0.25,a*0.9);
    }
    // body glow
    flame(x,y,40,0.9);
    // head highlight
    ctx.fillStyle='rgba(255,240,200,.9)';
    ctx.beginPath(); ctx.arc(x+6,y-6,6,0,TAU); ctx.fill();
    blendNorm(ctx);

    // light vignette
    ctx.fillStyle='rgba(255,150,60,0.06)';
    ctx.fillRect(0,0,w,h);

    if(t<1){ requestAnimationFrame(loop); }
    else { // exit burst + micro shake
      const burstStart=performance.now(); const bd=220;
      (function burst(now2){
        const tb=Math.min(1,(now2-burstStart)/bd);
        ctx.clearRect(0,0,w,h);
        shakeFrame(ctx,tb,4);
        blendAdd(ctx);
        flame(x+20,y-10,120*(1-tb*0.6),0.55*(1-tb));
        blendNorm(ctx);
        shakeRestore(ctx);
        if(tb<1) requestAnimationFrame(burst); else endFX();
      })(burstStart);
    }
  })(start);
}

/* --- Unicorn (rainbow trail + stars) --- */
function unicornFX(){
  const {ctx,w,h}=ensureFX(); const start=performance.now(); const dur=1400;
  ctx.font='64px system-ui, Apple Color Emoji, Segoe UI Emoji';
  (function loop(now){
    const t=Math.min(1,(now-start)/dur), p=easeInOut(t);
    ctx.clearRect(0,0,w,h);
    const x=lerp(-80,w+80,p), y=lerp(h*0.65,h*0.35,p);
    // rainbow trail
    const grad=ctx.createLinearGradient(x-160,y-40,x,y+40);
    ['red','orange','yellow','green','blue','indigo','violet'].forEach((c,i)=>grad.addColorStop(i/6,c));
    ctx.globalAlpha=0.8*(1-t); ctx.fillStyle=grad; ctx.fillRect(x-180,y-20,160,40); ctx.globalAlpha=1;
    // stars
    blendAdd(ctx);
    for(let i=0;i<40;i++){
      const sx=x- (R()*160); const sy=y+(R()*60-30);
      const r=R()*2+1; ctx.fillStyle='rgba(255,255,255,.9)';
      ctx.beginPath(); ctx.arc(sx,sy,r,0,TAU); ctx.fill();
    }
    blendNorm(ctx);
    // the unicorn emoji as the hero
    ctx.fillText('ü¶Ñ', x-24, y+18);
    if(t<1) requestAnimationFrame(loop); else endFX();
  })(start);
}

/* --- Jet (contrail + shock ring + shake) --- */
function jetFX(){
  const {ctx,w,h}=ensureFX(); const start=performance.now(); const dur=1200;
  ctx.font='60px system-ui, Apple Color Emoji, Segoe UI Emoji';
  (function loop(now){
    const t=Math.min(1,(now-start)/dur), p=easeInOut(t);
    ctx.clearRect(0,0,w,h);
    const x=lerp(-120,w+120,p), y=lerp(h*0.55,h*0.35,p);
    // contrail
    blendAdd(ctx);
    ctx.fillStyle='rgba(255,255,255,.55)';
    ctx.fillRect(x-160,y-4,150,8);
    // shock ring at mid
    if(t>0.45 && t<0.7){
      const k=(t-0.45)/0.25, r=lerp(10,120,k);
      ctx.strokeStyle='rgba(255,255,255,'+(1-k)+')'; ctx.lineWidth=3;
      ctx.beginPath(); ctx.arc(x-40,y,r,0,TAU); ctx.stroke();
    }
    blendNorm(ctx);
    // plane emoji
    ctx.fillText('üõ©Ô∏è', x-20, y+18);
    if(t<1){ requestAnimationFrame(loop); }
    else{
      // brief shake & fade
      const s0=performance.now(), d=180;
      (function shake(now2){
        const tt=(now2-s0)/d; ctx.clearRect(0,0,w,h);
        shakeFrame(ctx, tt, 3); ctx.fillStyle='rgba(255,255,255,'+(1-tt)+')'; ctx.fillRect(0,0,w,h); shakeRestore(ctx);
        if(tt<1) requestAnimationFrame(shake); else endFX();
      })(s0);
    }
  })(start);
}

/* --- Castle (prism sparkles + shine) --- */
function castleFX(){
  const {ctx,w,h}=ensureFX(); const start=performance.now(); const dur=1400;
  ctx.font='70px system-ui, Apple Color Emoji, Segoe UI Emoji';
  (function loop(now){
    const t=Math.min(1,(now-start)/dur); const p=easeOutCubic(t);
    ctx.clearRect(0,0,w,h);
    const x=w/2, y=lerp(h*0.8,h*0.45,p);
    // glow base
    blendAdd(ctx);
    for(let i=0;i<3;i++){
      ctx.fillStyle=`rgba(180,220,255,${0.15*(1-t)})`;
      ctx.beginPath(); ctx.arc(x,y+20,120+i*20,0,TAU); ctx.fill();
    }
    // sparkles
    for(let i=0;i<40;i++){
      const ang=R()*TAU, r=R()*120; const px=x+Math.cos(ang)*r, py=y+Math.sin(ang)*r;
      ctx.fillStyle='rgba(255,255,255,.9)'; ctx.fillRect(px,py,2,2);
    }
    blendNorm(ctx);
    // castle glyph
    ctx.textAlign='center'; ctx.fillText('üè∞', x, y);
    if(t<1) requestAnimationFrame(loop); else endFX();
  })(start);
}

/* --- Chest (coin fountain) --- */
function chestFX(){
  const {ctx,w,h}=ensureFX(); const start=performance.now(); const dur=1300;
  const coins=Array.from({length:80},()=>({
    x:w/2 + (R()*120-60), y:h*0.6, vx:(R()*2-1)*2, vy:- (R()*4+3), r:R()*3+2, a:1
  }));
  (function loop(now){
    const t=Math.min(1,(now-start)/dur);
    ctx.clearRect(0,0,w,h);
    // chest body
    ctx.fillStyle='#6d4c41'; ctx.fillRect(w/2-60,h*0.6,120,50);
    ctx.fillStyle='#8d6e63'; ctx.fillRect(w/2-60,h*0.6-20,120,22);
    // coins
    blendAdd(ctx);
    coins.forEach(c=>{
      c.x+=c.vx; c.y+=c.vy; c.vy+=0.15; c.a*=0.985;
      const g=ctx.createRadialGradient(c.x,c.y,0,c.x,c.y,c.r*2.2);
      g.addColorStop(0,`rgba(255,240,180,${c.a})`);
      g.addColorStop(1,`rgba(255,215,80,0)`);
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(c.x,c.y,c.r,0,TAU); ctx.fill();
    });
    blendNorm(ctx);
    if(t<1) requestAnimationFrame(loop); else endFX();
  })(start);
}

/* --- Rolex (prismatic sparkle ring) --- */
function rolexFX(){
  const {ctx,w,h}=ensureFX(); const start=performance.now(); const dur=1100;
  const x=w/2, y=h/2, R0=26, R1=120;
  (function loop(now){
    const t=Math.min(1,(now-start)/dur);
    ctx.clearRect(0,0,w,h);
    blendAdd(ctx);
    for(let i=0;i<32;i++){
      const ang=i*(TAU/32) + now*0.006;
      const r=lerp(R0,R1,t);
      const px=x+Math.cos(ang)*r, py=y+Math.sin(ang)*r;
      ctx.fillStyle=`hsla(${(i*12)%360},100%,70%,${1-t})`;
      ctx.beginPath(); ctx.arc(px,py,3,0,TAU); ctx.fill();
    }
    blendNorm(ctx);
    // center glint
    ctx.fillStyle='rgba(255,255,255,'+(1-t)+')'; ctx.beginPath(); ctx.arc(x,y,6,0,TAU); ctx.fill();
    if(t<1) requestAnimationFrame(loop); else endFX();
  })(start);
}

/* ====== Dispatch ====== */
const dispatch={
  // common/rare
  party:anim_party, lick:anim_lick, butterfly:anim_butterfly, car:anim_car,
  rose:anim_rose, champagne:anim_champagne, clink:anim_clink, clap:anim_clap, kiss:anim_kiss, coins:anim_coins,
  storm:anim_storm, rainbow:anim_rainbow, snow:anim_snow, sun:anim_sun, crown:anim_crown,
  planeSimple:anim_planeSimple, yacht:anim_yacht,

  // billionaire
  phoenixFX:phoenixFX, unicornFX:unicornFX, castleFX:castleFX, chestFX:chestFX, jetFX:jetFX, rolexFX:rolexFX,

  // fallback
  sparkle:()=>fallback('‚ú®')
};
function runAnim(key, emoji){ (dispatch[key] || (()=>fallback(emoji)))() }

/* ====== Interactions ====== */
function show(id){Object.values(EL.screens).forEach(s=>s.classList.remove('active')); EL.screens[id].classList.add('active')}
function mountNav(){
  const nav=el('nav','nav'); nav.innerHTML=`<a class="item" data-go="home"><div>üè†</div><div>Home</div></a>
  <a class="item" data-go="gifts"><div>üéÅ</div><div>Gifts</div></a>
  <button class="honeypot" title="Go Live"></button>
  <a class="item" data-go="wallet"><div>üí∞</div><div>Wallet</div></a>
  <a class="item" data-go="profile"><div>üë§</div><div>Profile</div></a>`;
  document.body.appendChild(nav);
  nav.addEventListener('click',e=>{const a=e.target.closest('[data-go]'); if(!a) return; show(a.getAttribute('data-go'))});
  nav.querySelector('.honeypot').addEventListener('click',()=>showToast('Go Live (demo) ‚Äî honeypot button!'));
}
function showCombo(n){const c=el('div','combo'); c.textContent='Combo x'+n; document.body.appendChild(c); setTimeout(()=>c.remove(),600)}
function sendOne(giftEl){
  const price=+giftEl.dataset.price; const emoji=giftEl.querySelector('.emo').textContent; const anim=giftEl.dataset.anim||'';
  if(!spend(price)){showToast('Not enough BuzzCoins'); return false}
  runAnim(anim, emoji); return true;
}
function bindGifting(){
  let combo=0, hold=null, pressing=false, highlighted=null;
  function select(el){ if(highlighted) highlighted.classList.remove('highlight'); highlighted=el; el.classList.add('highlight'); setTimeout(()=>{ if(highlighted===el) el.classList.remove('highlight')},1600)}
  function startHold(el){ pressing=true; combo=0; if(sendOne(el)){ combo=1; showCombo(combo)} hold=setInterval(()=>{ if(sendOne(el)){ combo++; if(combo%2===0) showCombo(combo)} else stopHold()},180)}
  function stopHold(){ pressing=false; clearInterval(hold); hold=null }
  document.addEventListener('pointerdown',e=>{const el=e.target.closest('.gift'); if(!el) return; select(el); S.holdTimer=setTimeout(()=>startHold(el),180)})
  document.addEventListener('pointerup',e=>{clearTimeout(S.holdTimer); const el=e.target.closest('.gift'); if(!el) return; if(!pressing) sendOne(el); stopHold()})
  document.addEventListener('pointerleave',()=>{clearTimeout(S.holdTimer); stopHold()})
}

/* Wallet buttons + dev gestures */
function bindWallet(){
  EL.btnTopup.addEventListener('click',()=>{S.regular+=100; save(); updateUI(); showToast('+100 BuzzCoins')});
  EL.btnReset.addEventListener('click',()=>{localStorage.removeItem('buzz_demo_bfx'); S.regular=300; S.ad=0; S.spent=0; S.adsToday=0; S.lastAdDate=null; save(); updateUI(); showToast('Demo reset')});

  // Ads with 5/day + 5s cooldown
  let cool=false;
  EL.btnWatchAd.addEventListener('click',()=>{
    const today=new Date().toISOString().slice(0,10);
    if(S.lastAdDate!==today){S.adsToday=0;S.lastAdDate=today}
    if(S.adsToday>=5) return showToast('Daily ad limit reached');
    if(cool) return showToast('Please wait 5s‚Ä¶');
    S.ad+=1; S.adsToday+=1; save(); updateUI(); showToast('+1 from Ad');
    cool=true; EL.btnWatchAd.disabled=true; setTimeout(()=>{cool=false; EL.btnWatchAd.disabled=false},5000);
  });

  // Dev gestures on balance: triple-tap = +100, long-press = +500
  let taps=0, tapTimer=null, pressTimer=null;
  EL.balance.addEventListener('pointerdown',()=>{ pressTimer=setTimeout(()=>{ S.regular+=500; save(); updateUI(); showToast('+500 (long-press)') }, 600); });
  EL.balance.addEventListener('pointerup',()=>{
    clearTimeout(pressTimer);
    taps++; clearTimeout(tapTimer);
    tapTimer=setTimeout(()=>{ if(taps>=3){ S.regular+=100; save(); updateUI(); showToast('+100 (triple-tap)') } taps=0; }, 320);
  });
}

/* ====== Boot ====== */
document.addEventListener('DOMContentLoaded', ()=>{
  try{
    load(); updateUI(); mountGifts(); bindGifting(); bindWallet(); mountNav();
  }catch(e){ showErr('Init error: '+(e?.message||e)); }
});
</script>
</body>
</html>