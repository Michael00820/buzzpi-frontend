<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>BuzzPi â€” Demo (Alive Gifts v2)</title>
<meta name="theme-color" content="#0b0b0f" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<style>
  :root{
    --bg:#ffffff; --fg:#0e0e12; --muted:#68707a; --card:#f7f8fa; --gold:#f7c948; --gold2:#e8b12e; --accent:#7b5df9;
    --ring:0 6px 18px rgba(0,0,0,.12);
  }
  @media (prefers-color-scheme: dark){
    :root{ --bg:#0b0b0f; --fg:#eef0f3; --muted:#98a0aa; --card:#111318; --ring:0 8px 24px rgba(0,0,0,.45); }
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .app{max-width:800px;margin:0 auto;padding-bottom:84px}
  header{position:sticky;top:0;z-index:30;background:var(--bg);padding:12px 16px;border-bottom:1px solid rgba(127,127,127,.15)}
  .row{display:flex;gap:12px;align-items:center;justify-content:space-between}
  .logo{display:flex;gap:10px;align-items:center;font-weight:800}
  .logo-badge{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--gold),var(--gold2));box-shadow:var(--ring)}
  .tabs{display:flex;gap:8px;overflow:auto;padding:10px 16px}
  .chip{flex:0 0 auto;padding:8px 12px;border-radius:999px;background:var(--card);font-weight:600;color:var(--muted)}
  .chip.active{background:linear-gradient(135deg,#5b35f6,#7b5df9);color:#fff}
  .screen{display:none;padding:12px 16px}
  .screen.active{display:block}

  /* Wallet */
  .card{background:var(--card);border-radius:16px;padding:16px;box-shadow:var(--ring);margin-bottom:14px}
  .coins{font-size:28px;font-weight:800}
  .muted{color:var(--muted);font-size:13px}
  .btn{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(135deg,#5b35f6,#7b5df9);color:#fff;border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
  .btn.secondary{background:linear-gradient(135deg,#222,#333)}
  .btn.gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:#212121}
  .rowBtns{display:flex;gap:10px;flex-wrap:wrap}
  .small{font-size:12px}
  .bar{height:10px;background:#1f2330;border-radius:999px;overflow:hidden}
  .bar>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#5b35f6,#7b5df9)}

  /* Gift Shop */
  .gsec{margin:18px 0}
  .gtitle{display:flex;align-items:center;gap:10px;margin:6px 0 10px}
  .gtitle span{font-weight:800}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  @media (max-width:520px){ .grid{grid-template-columns:repeat(3,1fr)} }
  .gift{background:var(--card);border-radius:14px;padding:10px;text-align:center;cursor:pointer;user-select:none;position:relative;box-shadow:var(--ring);transition:.2s}
  .gift .emo{font-size:26px;line-height:1}
  .gift .name{font-size:11px;color:var(--muted);margin-top:4px}
  .gift .price{font-size:12px;font-weight:800;margin-top:4px}
  .gift:active{transform:scale(.98)}
  .gift[data-tier="billionaire"]{outline:2px solid rgba(247,201,72,.25)}
  .gift[data-tier="rare"]{outline:2px solid rgba(91,53,246,.25)}

  /* Selection breathing/heartbeat */
  .gift.highlight::after{
    content:""; position:absolute; inset:-2px; border-radius:16px;
    box-shadow:0 0 0 0 rgba(123,93,249,.5);
    animation:heartbeat 1200ms ease-in-out infinite;
  }
  @keyframes heartbeat{
    0%{transform:scale(1); box-shadow:0 0 0 0 rgba(123,93,249,.45)}
    25%{transform:scale(1.02); box-shadow:0 0 0 8px rgba(123,93,249,.15)}
    50%{transform:scale(1); box-shadow:0 0 0 0 rgba(123,93,249,.0)}
    75%{transform:scale(1.02); box-shadow:0 0 0 8px rgba(123,93,249,.12)}
    100%{transform:scale(1); box-shadow:0 0 0 0 rgba(123,93,249,.0)}
  }

  /* Stage for gift animations */
  .stage{position:fixed;inset:0;pointer-events:none;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .combo{position:fixed;top:18%;left:50%;transform:translateX(-50%);font-weight:900;font-size:28px;background:linear-gradient(135deg,#5b35f6,#7b5df9);color:#fff;padding:6px 12px;border-radius:12px;box-shadow:var(--ring);opacity:0;animation:combo .3s ease forwards}
  @keyframes combo{to{opacity:1;transform:translateX(-50%) scale(1.05)}}

  /* Generic sparkles */
  .pop{position:absolute;font-size:64px;animation:pop .6s ease-out forwards}
  @keyframes pop{0%{transform:scale(.5);opacity:.0} 40%{transform:scale(1.1);opacity:1} 100%{transform:scale(1) translateY(-120px);opacity:0}}
  .spark{position:absolute;width:6px;height:6px;border-radius:50%;background:radial-gradient(circle,#fff,#ffd);animation:spark 800ms ease-out forwards}
  @keyframes spark{from{transform:translate(0,0);opacity:1} to{transform:translate(var(--dx),var(--dy));opacity:0}}

  /* ğŸ¥³ Party: horn + confetti */
  .party{position:absolute; width:120px; height:120px; animation:partyUp 1s ease-out forwards}
  @keyframes partyUp{from{transform:translateY(40px); opacity:0} 20%{opacity:1} to{transform:translateY(-40px); opacity:0}}
  .horn{position:absolute; left:46px; top:52px; width:28px; height:10px; background:linear-gradient(90deg,#fdd835,#f06292); border-radius:10px; transform-origin:left center; animation:hornUnroll .7s ease-out forwards}
  @keyframes hornUnroll{from{transform:scaleX(.2) rotate(-10deg)} to{transform:scaleX(1.2) rotate(8deg)}}
  .conf{position:absolute; width:6px; height:10px; border-radius:2px; animation:confDrop 900ms ease-out forwards}
  @keyframes confDrop{from{transform:translateY(-10px) rotate(0)} to{transform:translateY(80px) rotate(240deg); opacity:0}}

  /* ğŸ˜‹ Tongue lick */
  .lick{position:absolute; width:120px; height:120px; }
  .mouth{position:absolute; left:42px; top:54px; width:36px; height:22px; background:#111; border-radius:0 0 18px 18px; overflow:hidden}
  .tongue{position:absolute; left: -10px; top: 6px; width: 30px; height: 14px; background:#e26d77; border-radius:14px; animation:lick 800ms ease-out forwards}
  @keyframes lick{0%{transform:translateX(0)} 40%{transform:translateX(42px)} 70%{transform:translateX(42px)} 100%{transform:translateX(0)}}

  /* ğŸ¦‹ Butterfly */
  .bfly{position:absolute; width:64px; height:64px; transform-origin:center; animation:bfFloat 1s ease-in-out forwards}
  .bf-body{position:absolute; left:30px; top:20px; width:6px; height:24px; background:#3b2a22; border-radius:6px}
  .wing{position:absolute; width:28px; height:28px; border-radius:50% 45% 50% 45%; background:radial-gradient(circle at 30% 30%, #ffb6c1, #ff69b4); opacity:.95; transform-origin:28px 14px; filter:drop-shadow(0 2px 6px rgba(0,0,0,.25))}
  .wing.left{left:10px; top:12px; transform:rotateZ(12deg); animation:flap .25s ease-in-out infinite alternate}
  .wing.right{left:28px; top:12px; transform:scaleX(-1) rotateZ(12deg); animation:flap .25s ease-in-out infinite alternate}
  @keyframes flap{from{transform:rotateZ(6deg)} to{transform:rotateZ(26deg)}}
  @keyframes bfFloat{0%{transform:translate(-20px,40px) rotate(-8deg); opacity:0} 20%{opacity:1} 50%{transform:translate(0px,-10px) rotate(5deg)} 100%{transform:translate(120px,-60px) rotate(12deg); opacity:.0}}

  /* ğŸï¸ / ğŸš™ Car/Hummer */
  .car{position:absolute; width:120px; height:52px; transform-origin:center; animation:carEnter .45s ease-out forwards, carExit .6s ease-in forwards .6s}
  .car-body{position:absolute; left:10px; right:10px; top:10px; bottom:10px; border-radius:12px; background:linear-gradient(135deg,#18a558,#0b7a44); box-shadow:0 6px 12px rgba(0,0,0,.3)}
  .car-body.hummer{background:linear-gradient(135deg,#c8a045,#a67c22)}
  .wheel{position:absolute; bottom:2px; width:22px; height:22px; border-radius:50%; background:radial-gradient(circle at 35% 35%,#000,#222); border:3px solid #444; animation:spin .5s linear infinite}
  .wheel::after{content:""; position:absolute; left:50%; top:50%; width:8px; height:8px; transform:translate(-50%,-50%); background:#888; border-radius:50%}
  .wheel.l{left:14px} .wheel.r{right:14px}
  .smoke{position:absolute; bottom:8px; left:2px; width:10px; height:10px; border-radius:50%; background:radial-gradient(circle,#fff,#bbb0); filter:blur(1px); animation:puff .6s ease-out forwards}
  @keyframes carEnter{from{transform:translateX(-160px) rotate(-12deg)} to{transform:translateX(0) rotate(-2deg)}}
  @keyframes carExit{to{transform:translateX(240px) rotate(3deg); opacity:0}}
  @keyframes spin{to{transform:rotate(360deg)}}
  @keyframes puff{to{transform:translate(-24px,-10px) scale(1.8); opacity:0}}

  /* ğŸŒ¹ Rose petals */
  .petal{position:absolute; width:10px; height:14px; background:radial-gradient(circle at 30% 30%,#ff8aa1,#e6406f); border-radius:10px 10px 2px 10px; transform:rotate(20deg); opacity:.95; animation:fall 900ms ease-in forwards}
  @keyframes fall{from{transform:translateY(-20px) rotate(20deg)} to{transform:translateY(120px) rotate(60deg); opacity:0}}

  /* ğŸ¾ Champagne bubbles */
  .bubble{position:absolute; width:8px; height:8px; border-radius:50%; background:radial-gradient(circle,#fff,#fff0); border:1px solid #fff8; animation:rise 900ms ease-out forwards}
  @keyframes rise{from{transform:translateY(0) scale(.6); opacity:.8} to{transform:translateY(-120px) scale(1.1); opacity:0}}

  /* ğŸ»/ğŸ¥‚ clink spark */
  .clink{position:absolute; width:16px; height:16px; border-radius:50%; border:2px solid #fff8; animation:clinkPop 500ms ease-out forwards}
  @keyframes clinkPop{from{transform:scale(.4); opacity:.8} to{transform:scale(1.6); opacity:0}}

  /* ğŸ‘ clap shocklines */
  .shock{position:absolute; width:2px; height:14px; background:#fff8; animation:shockOut 400ms ease-out forwards}
  @keyframes shockOut{from{transform:scaleY(.4); opacity:.9} to{transform:scaleY(1.4) translateY(-14px); opacity:0}}

  /* ğŸ’‹ kiss marks */
  .kiss{position:absolute; font-size:42px; animation:kissUp 800ms ease-out forwards}
  @keyframes kissUp{from{transform:translateY(20px); opacity:.2} to{transform:translateY(-80px); opacity:0}}

  /* ğŸ¤‘ coin rain */
  .coin{position:absolute; width:14px; height:14px; border-radius:50%; background:radial-gradient(circle,#ffd54f,#fbc02d); box-shadow:0 1px 2px rgba(0,0,0,.25); animation:coinFall 900ms ease-in forwards}
  @keyframes coinFall{from{transform:translateY(-40px) rotate(0)} to{transform:translateY(120px) rotate(360deg); opacity:0}}

  /* ğŸŒ© lightning + flicker */
  .flash{position:fixed; inset:0; background:#fff8; animation:flash 180ms ease-out forwards}
  @keyframes flash{from{opacity:1} to{opacity:0}}
  .bolt{position:absolute; width:4px; height:120px; background:linear-gradient(#fff,#fff0); transform:skewX(-20deg); animation:boltDrop 280ms ease-out forwards}
  @keyframes boltDrop{from{transform:translateY(-60px) skewX(-20deg)} to{transform:translateY(40px) skewX(-20deg); opacity:0}}

  /* ğŸŒˆ rainbow arc */
  .rainbow{position:absolute; width:220px; height:110px; border-radius:110px 110px 0 0; background:conic-gradient(from 180deg, red, orange, yellow, green, blue, indigo, violet, red); mask: radial-gradient(110px 70px at 50% 100%, transparent 60%, black 61%); animation:rb 1.2s ease-out forwards}
  @keyframes rb{from{transform:translateX(-160px); opacity:.2} to{transform:translateX(160px); opacity:0}}

  /* â„ snowflake */
  .flake{position:absolute; width:10px; height:10px; background:radial-gradient(circle,#fff,#fff0); border-radius:50%; animation:flake 1200ms ease-in forwards}
  @keyframes flake{from{transform:translate(-20px,-20px)} to{transform:translate(40px,120px); opacity:0}}

  /* ğŸŒ¤ sun rays */
  .sun{position:absolute; width:80px; height:80px; border-radius:50%; background:radial-gradient(circle,#fff59d,#ffeb3b); box-shadow:0 0 20px #ffeb3b88; animation:sunUp 1s ease-out forwards}
  .ray{position:absolute; width:4px; height:24px; background:#ffe082; top:-12px; left:50%; transform-origin:50% 52px; opacity:.9}
  @keyframes sunUp{from{transform:translateY(40px); opacity:0} to{transform:translateY(-20px); opacity:0}}

  /* ğŸ‘‘ crown drop */
  .crown{position:absolute; width:90px; height:60px; background:linear-gradient(180deg,#f7c948,#d2a21d); clip-path:polygon(0% 60%, 15% 0, 30% 60%, 50% 0, 70% 60%, 85% 0, 100% 60%, 100% 100%, 0% 100%); animation:crown 900ms ease-out forwards}
  @keyframes crown{from{transform:translateY(-80px) rotate(-10deg); opacity:.2} to{transform:translateY(40px) rotate(6deg); opacity:0}}

  /* âœˆï¸ / ğŸ›©ï¸ fly-by */
  .plane{position:absolute; width:120px; height:36px; border-radius:6px; background:linear-gradient(135deg,#b3e5fc,#90caf9); box-shadow:0 4px 10px rgba(0,0,0,.25); animation:fly 1s ease-in-out forwards}
  .trail{position:absolute; width:140px; height:6px; background:linear-gradient(90deg,#fff8,#fff0); border-radius:6px; top:18px; left:-140px; animation:trail 1s ease-out forwards}
  @keyframes fly{from{transform:translateX(-200px) translateY(40px) rotate(-6deg); opacity:.2} to{transform:translateX(200px) translateY(-40px) rotate(4deg); opacity:0}}
  @keyframes trail{from{opacity:.8} to{opacity:0}}

  /* ğŸ›¥ï¸ yacht */
  .yacht{position:absolute; width:140px; height:40px; background:linear-gradient(180deg,#e0f7fa,#b2ebf2); border-radius:0 0 16px 16px; animation:float 1.2s ease-in-out forwards}
  .wave{position:absolute; width:200px; height:40px; background:radial-gradient(circle,#90caf9,#90caf900); bottom:-8px; left:-30px; filter:blur(4px); animation:wave 1s ease-out forwards}
  @keyframes float{from{transform:translateY(20px) rotate(-2deg); opacity:.4} 50%{transform:translateY(-6px) rotate(2deg); opacity:1} to{transform:translateY(30px); opacity:0}}
  @keyframes wave{from{opacity:.6} to{opacity:0}}

  /* ğŸ”¥ğŸ•Šï¸ Phoenix */
  .phoenix{position:absolute; width:90px; height:90px; border-radius:50%; background:radial-gradient(circle at 30% 30%,#ff9800,#f44336); box-shadow:0 0 30px #ff7043aa; animation:ph 1s ease-out forwards}
  .flame{position:absolute; width:10px; height:24px; background:radial-gradient(circle,#ffa726,#ff7043); border-radius:6px 6px 16px 16px; filter:blur(.6px); animation:flick .3s ease-in-out infinite alternate}
  @keyframes ph{from{transform:translateX(-120px) scale(.8); opacity:.4} 50%{opacity:1} to{transform:translateX(160px) scale(1); opacity:0}}
  @keyframes flick{from{transform:translateY(0) rotate(-6deg)} to{transform:translateY(-6px) rotate(6deg)}}

  /* ğŸ¦„ Unicorn gallop */
  .trailStar{position:absolute; width:8px; height:8px; background:radial-gradient(circle,#fff,#fff0); border-radius:50%; animation:tstar 600ms ease-out forwards}
  @keyframes tstar{from{transform:scale(.8); opacity:.8} to{transform:scale(1.6) translateY(-40px); opacity:0}}

  /* ğŸ° Castle rise */
  .castle{position:absolute; width:120px; height:80px; background:linear-gradient(180deg,#e3f2fd,#bbdefb); clip-path:polygon(0% 100%, 0% 30%, 20% 30%, 20% 0%, 34% 0%, 34% 30%, 66% 30%, 66% 0%, 80% 0%, 80% 30%, 100% 30%, 100% 100%); box-shadow:0 4px 10px rgba(0,0,0,.25); animation:rise 1s ease-out forwards}
  @keyframes rise{from{transform:translateY(80px); opacity:.2} to{transform:translateY(-20px); opacity:0}}

  /* ğŸ’° Chest burst */
  .chest{position:absolute; width:120px; height:60px; background:#6d4c41; border-radius:6px; box-shadow:0 4px 10px rgba(0,0,0,.25); animation:chest 900ms ease-out forwards}
  .gold{position:absolute; width:10px; height:10px; border-radius:50%; background:radial-gradient(circle,#ffd54f,#fbc02d); animation:goldUp 700ms ease-out forwards}
  @keyframes chest{from{transform:translateY(40px)} to{transform:translateY(-10px); opacity:0}}
  @keyframes goldUp{from{transform:translateY(0)} to{transform:translateY(-80px); opacity:0}}

  /* Toast */
  .toast{position:fixed;bottom:92px;left:50%;transform:translateX(-50%);background:#111c;border:1px solid #fff2;color:#fff;padding:10px 14px;border-radius:10px;backdrop-filter:blur(8px);font-size:13px;opacity:0;transition:.25s}
  .toast.show{opacity:1}
</style>
</head>
<body>
<div class="app">

  <header>
    <div class="row">
      <div class="logo"><div class="logo-badge"></div> BuzzPi</div>
      <div class="coins" id="balance">0</div>
    </div>
    <div class="tabs" id="topTabs">
      <div class="chip active">Following</div>
      <div class="chip">Popular</div>
      <div class="chip">Nearby</div>
      <div class="chip">Newcomers</div>
      <div class="chip">Trending</div>
    </div>
  </header>

  <!-- HOME -->
  <section class="screen active" id="scrHome">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:800">Welcome to BuzzPi (Demo)</div>
          <div class="muted">Tap the Gifts tab to try <b>alive</b> animations & coin flow.</div>
        </div>
        <div class="tag">Theme-adaptive âœ“</div>
      </div>
    </div>
  </section>

  <!-- GIFTS -->
  <section class="screen" id="scrGifts">
    <div class="gsec">
      <div class="gtitle"><span>Common</span><small class="muted">1â€“20 BuzzCoins</small></div>
      <div class="grid" id="gridCommon"></div>
    </div>
    <div class="gsec">
      <div class="gtitle"><span>Rare</span><small class="muted">50â€“500 BuzzCoins</small></div>
      <div class="grid" id="gridRare"></div>
    </div>
    <div class="gsec">
      <div class="gtitle"><span>Billionaire</span><small class="muted">1,000â€“10,000 BuzzCoins</small></div>
      <div class="grid" id="gridBillion"></div>
    </div>
  </section>

  <!-- WALLET -->
  <section class="screen" id="scrWallet">
    <div class="card">
      <div class="coins"><span id="cRegular">0</span> <span class="muted">BuzzCoins</span></div>
      <div class="muted">Ad-earned balance: <b id="cAd">0</b> (gifting only)</div>
      <div class="muted small" id="adInfo"></div>
      <div class="rowBtns" style="margin-top:12px">
        <button class="btn gold" id="btnTopup">Top up +100</button>
        <button class="btn" id="btnWatchAd">Watch Ad (+1)</button>
      </div>
      <div class="muted small" style="margin-top:8px">Ad limit: 5/day â€¢ 5s cooldown</div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:800">Level <span id="level">1</span></div>
          <div class="muted">Spend 500 coins on gifts to level up</div>
        </div>
        <div style="text-align:right">
          <div class="muted small">Progress: <b id="lvPct">0%</b></div>
        </div>
      </div>
      <div class="bar" style="margin-top:12px"><i id="lvBar"></i></div>
      <div class="muted small" id="lvHint" style="margin-top:8px"></div>
    </div>
  </section>

  <!-- PROFILE -->
  <section class="screen" id="scrProfile">
    <div class="card">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="logo-badge" style="width:44px;height:44px;border-radius:12px"></div>
        <div>
          <div style="font-weight:800">You (Demo)</div>
          <div class="muted small">Ranked badge & frames appear here later.</div>
        </div>
      </div>
    </div>
    <div class="card">
      <div style="font-weight:800;margin-bottom:8px">Stealth Mode (Phase 2)</div>
      <div class="muted small">Face mask + voice modulation will be here in Phase 2.</div>
    </div>
  </section>

</div>

<!-- Stage for gift animations -->
<div class="stage" id="stage"></div>
<div class="toast" id="toast"></div>

<script>
/*** STATE & ELEMENTS ***/
const S = { regular: 300, ad: 0, spent: 0, adsToday: 0, lastAdDate: null, holdTimer: null };
const EL = {
  screens:{ home:$('#scrHome'), gifts:$('#scrGifts'), wallet:$('#scrWallet'), profile:$('#scrProfile') },
  balance:$('#balance'), cRegular:$('#cRegular'), cAd:$('#cAd'), adInfo:$('#adInfo'),
  btnTopup:$('#btnTopup'), btnWatchAd:$('#btnWatchAd'),
  level:$('#level'), lvBar:$('#lvBar'), lvPct:$('#lvPct'), lvHint:$('#lvHint'),
  stage:$('#stage'), toast:$('#toast'),
  gridCommon:$('#gridCommon'), gridRare:$('#gridRare'), gridBillion:$('#gridBillion')
};
function $(q){ return document.querySelector(q); }
const fmt = n => n.toLocaleString();

/*** PERSISTENCE ***/
function save(){ localStorage.setItem('buzz_demo_v2', JSON.stringify({regular:S.regular, ad:S.ad, spent:S.spent, adsToday:S.adsToday, lastAdDate:S.lastAdDate})); }
function load(){ try{ Object.assign(S, JSON.parse(localStorage.getItem('buzz_demo_v2')||'{}')); }catch(_){} }

/*** UI ***/
function toast(msg, ms=1400){ EL.toast.textContent=msg; EL.toast.classList.add('show'); setTimeout(()=>EL.toast.classList.remove('show'), ms); }
function updateUI(){
  EL.balance.textContent = fmt(S.regular+S.ad);
  EL.cRegular.textContent = fmt(S.regular);
  EL.cAd.textContent = fmt(S.ad);
  const today = new Date().toISOString().slice(0,10);
  if(S.lastAdDate !== today){ S.adsToday=0; S.lastAdDate=today; save(); }
  EL.adInfo.textContent = `Ads watched today: ${S.adsToday}/5`;
  const perLevel = 500;
  const lvl = Math.min(99, Math.floor(S.spent/perLevel)+1);
  const into = S.spent % perLevel;
  const pct = Math.round((into/perLevel)*100);
  EL.level.textContent = lvl; EL.lvPct.textContent=pct+'%'; EL.lvBar.style.width=pct+'%'; EL.lvHint.textContent = `${fmt(perLevel-into)} coins to Level ${Math.min(99,lvl+1)}`;
}
function spend(amount){
  if(amount > S.regular+S.ad) return false;
  const useAd = Math.min(S.ad, amount); S.ad -= useAd; S.regular -= (amount-useAd); S.spent += amount; save(); updateUI(); return true;
}

/*** GIFTS DATA (with animation key) ***/
const gifts = {
  common:[
    {emoji:'ğŸ¥³',name:'Party',price:1,anim:'party'},
    {emoji:'ğŸ¥°',name:'Hearts',price:1,anim:'hearts'},
    {emoji:'ğŸ˜',name:'Love Eyes',price:1,anim:'heartEyes'},
    {emoji:'ğŸ˜‹',name:'Yum',price:1,anim:'lick'},
    {emoji:'ğŸ¤—',name:'Hug',price:1,anim:'hug'},
    {emoji:'ğŸ¤©',name:'Starry',price:1,anim:'starBurst'},
    {emoji:'ğŸ¤‘',name:'Cashy',price:1,anim:'coins'},
    {emoji:'ğŸ­',name:'Lollipop',price:2,anim:'spinPop'},
    {emoji:'ğŸ¬',name:'Candy',price:2,anim:'twirl'},
    {emoji:'ğŸ«',name:'Chocolate',price:2,anim:'choc'},
    {emoji:'ğŸ¸',name:'Cocktail',price:5,anim:'splash'},
    {emoji:'ğŸ',name:'Apple',price:5,anim:'bounce'},
    {emoji:'ğŸº',name:'Beer',price:5,anim:'foam'},
    {emoji:'ğŸŒ¹',name:'Rose',price:10,anim:'rose'},
    {emoji:'ğŸŒ¸',name:'Blossom',price:10,anim:'bloom'},
    {emoji:'âœ¨',name:'Sparkle',price:10,anim:'sparkle'},
    {emoji:'ğŸ’',name:'Bouquet',price:20,anim:'bloomMany'},
    {emoji:'ğŸ»',name:'Cheers',price:20,anim:'clink'},
    {emoji:'ğŸ‘',name:'Clap',price:20,anim:'clap'},
    {emoji:'ğŸ’‹',name:'Kiss',price:20,anim:'kiss'}
  ],
  rare:[
    {emoji:'ğŸ¦‹',name:'Butterfly',price:50,anim:'butterfly'},
    {emoji:'ğŸŒ©',name:'Storm',price:50,anim:'storm'},
    {emoji:'ğŸŒ¤',name:'Sunrise',price:50,anim:'sun'},
    {emoji:'ğŸŒˆ',name:'Rainbow',price:50,anim:'rainbow'},
    {emoji:'â„ï¸',name:'Snow',price:50,anim:'snow'},
    {emoji:'ğŸ§¸',name:'Teddy',price:100,anim:'teddy'},
    {emoji:'ğŸ‡',name:'Bunny',price:100,anim:'bunny'},
    {emoji:'ğŸ¾',name:'Champagne',price:100,anim:'champagne'},
    {emoji:'ğŸ‘‘',name:'Crown',price:100,anim:'crown'},
    {emoji:'ğŸ·',name:'Wine',price:100,anim:'swirl'},
    {emoji:'ğŸ¥‚',name:'Toast',price:100,anim:'clink'},
    {emoji:'ğŸï¸',name:'Jade Lamborghini',price:500,anim:'car'},
    {emoji:'âœˆï¸',name:'Crystal Aeroplane',price:500,anim:'plane'},
    {emoji:'ğŸš™',name:'Golden Hummer',price:500,anim:'hummer'},
    {emoji:'ğŸ›¥ï¸',name:'Yacht',price:500,anim:'yacht'}
  ],
  billionaire:[
    {emoji:'ğŸ”¥ğŸ•Šï¸',name:'Fiery Phoenix',price:1000,anim:'phoenix'},
    {emoji:'ğŸ¦„',name:'Racing Unicorn',price:1000,anim:'unicorn'},
    {emoji:'ğŸ°',name:'Crystal Castle',price:1000,anim:'castle'},
    {emoji:'ğŸ’°',name:'Treasure Chest',price:1000,anim:'chest'},
    {emoji:'ğŸ¯â˜ï¸',name:'Mansion in the Sky',price:5000,anim:'castle'},
    {emoji:'ğŸ§œâ€â™€ï¸',name:'Mermaid',price:5000,anim:'splash'},
    {emoji:'ğŸ’˜',name:'Cupids',price:5000,anim:'hearts'},
    {emoji:'ğŸ§â€â™€ï¸',name:'Elf Queen',price:5000,anim:'sparkle'},
    {emoji:'ğŸ›©ï¸âœ¨',name:'Golden Private Jet',price:10000,anim:'plane'},
    {emoji:'ğŸ’âŒš',name:'Diamond Rolex',price:10000,anim:'sparkle'},
    {emoji:'ğŸğŸš—',name:'Chariots of Horses',price:10000,anim:'unicorn'}
  ]
};

/*** RENDER GIFTS & SELECT HIGHLIGHT ***/
function giftEl(g){
  const el = document.createElement('div');
  el.className='gift';
  el.dataset.price=g.price; el.dataset.anim=g.anim||''; el.dataset.name=g.name;
  el.innerHTML=`<div class="emo">${g.emoji}</div><div class="name">${g.name}</div><div class="price">${fmt(g.price)}ğŸª™</div>`;
  return el;
}
function mountGifts(){
  gifts.common.forEach(g=>EL.gridCommon.appendChild(giftEl(g)));
  gifts.rare.forEach(g=>{ const el=giftEl(g); el.dataset.tier='rare'; EL.gridRare.appendChild(el); });
  gifts.billionaire.forEach(g=>{ const el=giftEl(g); el.dataset.tier='billionaire'; EL.gridBillion.appendChild(el); });
}

/*** HELPERS ***/
function center(){ return {x:innerWidth/2,y:innerHeight/2}; }
function add(el,ms=1000){ EL.stage.appendChild(el); setTimeout(()=>el.remove(),ms); }

/*** ANIMATORS (alive behaviors) ***/
function anim_party(){
  const box = div('party'); const {x,y}=center(); box.style.left=(x-60)+'px'; box.style.top=(y-60)+'px';
  const horn = div('horn'); box.appendChild(horn);
  // confetti
  for(let i=0;i<18;i++){ const c=div('conf'); c.style.left=(50+Math.random()*40-20)+'px'; c.style.top=(40+Math.random()*10-5)+'px'; c.style.background=['#f44336','#ff9800','#ffeb3b','#4caf50','#2196f3','#9c27b0'][i%6]; c.style.animationDelay=(i*30)+'ms'; box.appendChild(c); }
  add(box,1000);
}
function anim_lick(){
  const b=div('lick'); const {x,y}=center(); b.style.left=(x-60)+'px'; b.style.top=(y-60)+'px';
  const mouth=div('mouth'); const tongue=div('tongue'); mouth.appendChild(tongue); b.appendChild(mouth); add(b,900);
}
function anim_butterfly(){
  const {x,y}=center(); const root=div('bfly'); root.style.left=(x-32)+'px'; root.style.top=y+'px';
  root.innerHTML=`<div class="bf-body"></div><div class="wing left"></div><div class="wing right"></div>`; add(root,1000);
}
function anim_car(gold=false){
  const {x,y}=center(); const car=div('car'); car.style.left=(x-60)+'px'; car.style.top=y+'px';
  car.innerHTML=`<div class="car-body ${gold?'hummer':''}"></div><div class="wheel l"></div><div class="wheel r"></div>`;
  for(let i=0;i<3;i++){ const s=div('smoke'); s.style.left=(x-30)+'px'; s.style.top=(y+20)+'px'; s.style.animationDelay=(i*120)+'ms'; add(s,600+i*120); }
  add(car,1400);
}
function anim_rose(){
  const {x,y}=center(); for(let i=0;i<12;i++){ const p=div('petal'); p.style.left=(x+(Math.random()*120-60))+'px'; p.style.top=(y+(Math.random()*-30-10))+'px'; p.style.animationDelay=(i*40)+'ms'; add(p,1000+i*40); }
}
function anim_champagne(){
  const {x,y}=center(); for(let i=0;i<14;i++){ const b=div('bubble'); b.style.left=(x+(Math.random()*50-25))+'px'; b.style.top=(y+20+(Math.random()*20-10))+'px'; b.style.animationDelay=(i*40)+'ms'; add(b,1000+i*40); }
}
function anim_clink(){
  const {x,y}=center(); for(let i=0;i<6;i++){ const c=div('clink'); c.style.left=(x+(Math.random()*30-15))+'px'; c.style.top=(y+(Math.random()*-10-10))+'px'; c.style.animationDelay=(i*50)+'ms'; add(c,500+i*50); }
}
function anim_clap(){
  const {x,y}=center(); for(let i=0;i<6;i++){ const s=div('shock'); s.style.left=(x+(i*8-20))+'px'; s.style.top=(y-6)+'px'; add(s,420); }
}
function anim_kiss(){
  const {x,y}=center(); for(let i=0;i<6;i++){ const k=div('kiss'); k.textContent='ğŸ’‹'; k.style.left=(x+(Math.random()*40-20))+'px'; k.style.top=(y+10)+'px'; k.style.animationDelay=(i*60)+'ms'; add(k,900+i*60); }
}
function anim_coins(){
  const {x,y}=center(); for(let i=0;i<20;i++){ const c=div('coin'); c.style.left=(x+(Math.random()*120-60))+'px'; c.style.top=(y-40+(Math.random()*20-10))+'px'; c.style.animationDelay=(i*30)+'ms'; add(c,900+i*30); }
}
function anim_spinPop(){
  // lollipop spin + sparkles
  anim_sparkle(); // quick sparkle support
}
function anim_twirl(){ anim_sparkle(); }
function anim_choc(){ anim_sparkle(); }
function anim_splash(){ anim_sparkle(); }
function anim_bounce(){ anim_sparkle(); }
function anim_foam(){ anim_sparkle(); }
function anim_bloom(){ anim_rose(); }
function anim_bloomMany(){ anim_rose(); }
function anim_sparkle(){
  const {x,y}=center(); for(let i=0;i<10;i++){ const s=div('spark'); s.style.left=x+'px'; s.style.top=y+'px'; s.style.setProperty('--dx',((Math.random()*2-1)*140|0)+'px'); s.style.setProperty('--dy',(-60 - Math.random()*120|0)+'px'; add(s,800); }
}
function anim_storm(){
  const f=div('flash'); add(f,180);
  const {x,y}=center(); for(let i=0;i<3;i++){ const b=div('bolt'); b.style.left=(x+(i*16-24))+'px'; b.style.top=(y-40)+'px'; add(b,280); }
}
function anim_rainbow(){
  const r=div('rainbow'); const {x,y}=center(); r.style.left=(x-110)+'px'; r.style.top=(y-80)+'px'; add(r,1200);
}
function anim_snow(){
  const {x,y}=center(); for(let i=0;i<14;i++){ const f=div('flake'); f.style.left=(x+(Math.random()*80-40))+'px'; f.style.top=(y-40)+'px'; add(f,1200); }
}
function anim_sun(){
  const {x,y}=center(); const s=div('sun'); s.style.left=(x-40)+'px'; s.style.top=(y-40)+'px'; for(let i=0;i<12;i++){ const ray=div('ray'); ray.style.transform=`rotate(${i*30}deg)`; s.appendChild(ray); } add(s,1000);
}
function anim_crown(){
  const c=div('crown'); const {x,y}=center(); c.style.left=(x-45)+'px'; c.style.top=(y-60)+'px'; add(c,900);
}
function anim_plane(gold=false){
  const {x,y}=center(); const p=div('plane'); p.style.left=(x-60)+'px'; p.style.top=(y)+'px'; const tr=div('trail'); p.appendChild(tr); if(gold){ p.style.background='linear-gradient(135deg,#ffe082,#ffd54f)'; } add(p,1000);
}
function anim_yacht(){
  const {x,y}=center(); const yb=div('yacht'); yb.style.left=(x-70)+'px'; yb.style.top=(y)+'px'; const w=div('wave'); yb.appendChild(w); add(yb,1200);
}
function anim_phoenix(){
  const {x,y}=center(); const ph=div('phoenix'); ph.style.left=(x-45)+'px'; ph.style.top=(y-45)+'px';
  for(let i=0;i<6;i++){ const fl=div('flame'); fl.style.left=(10+i*12)+'px'; fl.style.top=(56)+'px'; fl.style.animationDelay=(i*80)+'ms'; ph.appendChild(fl); }
  add(ph,1000);
}
function anim_unicorn(){
  const {x,y}=center(); for(let i=0;i<10;i++){ const t=div('trailStar'); t.style.left=(x-60+i*12)+'px'; t.style.top=(y-10-Math.random()*20)+'px'; add(t,600); }
}
function anim_castle(){
  const {x,y}=center(); const c=div('castle'); c.style.left=(x-60)+'px'; c.style.top=(y-40)+'px'; add(c,1000);
}
function anim_chest(){
  const {x,y}=center(); const ch=div('chest'); ch.style.left=(x-60)+'px'; ch.style.top=(y-20)+'px'; add(ch,900);
  for(let i=0;i<14;i++){ const g=div('gold'); g.style.left=(x+(Math.random()*80-40))+'px'; g.style.top=(y)+'px'; g.style.animationDelay=(i*40)+'ms'; add(g,700+i*40); }
}

/*** DISPATCH ***/
const dispatch = {
  party: anim_party, lick: anim_lick, butterfly: anim_butterfly, car: ()=>anim_car(false), hummer: ()=>anim_car(true),
  rose: anim_rose, champagne: anim_champagne, clink: anim_clink, clap: anim_clap, kiss: anim_kiss, coins: anim_coins,
  storm: anim_storm, rainbow: anim_rainbow, snow: anim_snow, sun: anim_sun, crown: anim_crown,
  plane: ()=>anim_plane(false), yacht: anim_yacht, phoenix: anim_phoenix, unicorn: anim_unicorn,
  castle: anim_castle, chest: anim_chest,
  hearts: anim_sparkle, heartEyes: anim_sparkle, spinPop: anim_sparkle, twirl: anim_sparkle, choc: anim_sparkle,
  splash: anim_sparkle, bounce: anim_sparkle, foam: anim_sparkle, bloom: anim_rose, bloomMany: anim_rose,
  sparkle: anim_sparkle
};
function runAnim(animKey, emoji){
  (dispatch[animKey] || fallback)(emoji);
}
function fallback(emoji){
  const p=document.createElement('div'); p.className='pop'; p.textContent=emoji;
  const {x,y}=center(); p.style.left=(x-28)+'px'; p.style.top=(y-28)+'px'; EL.stage.appendChild(p);
  for(let i=0;i<10;i++){ const s=document.createElement('div'); s.className='spark'; s.style.left=x+'px'; s.style.top=y+'px'; s.style.setProperty('--dx',((Math.random()*2-1)*140|0)+'px'); s.style.setProperty('--dy',(-60 - Math.random()*120|0)+'px'); EL.stage.appendChild(s); setTimeout(()=>s.remove(),800); }
  setTimeout(()=>p.remove(),620);
}
function div(cls){ const d=document.createElement('div'); d.className=cls; return d; }

/*** GIFT SEND + COMBO + HIGHLIGHT ***/
function showCombo(n){ const c=document.createElement('div'); c.className='combo'; c.textContent='Combo x'+n; document.body.appendChild(c); setTimeout(()=>c.remove(),600); }
function sendOne(el){
  const price=+el.dataset.price; const emoji=el.querySelector('.emo').textContent; const anim=el.dataset.anim||'';
  if(!spend(price)){ toast('Not enough BuzzCoins'); return false; }
  runAnim(anim, emoji); return true;
}
function bindGifting(){
  let combo=0, interval=null, pressing=false, highlighted=null;
  function select(el){ if(highlighted) highlighted.classList.remove('highlight'); highlighted=el; el.classList.add('highlight'); setTimeout(()=>{ if(highlighted===el) el.classList.remove('highlight'); }, 1600); }
  function startHold(el){ pressing=true; combo=0; if(sendOne(el)){ combo=1; showCombo(combo); } interval=setInterval(()=>{ if(sendOne(el)){ combo++; if(combo%2===0) showCombo(combo); } else stopHold(); }, 180); }
  function stopHold(){ pressing=false; if(interval){ clearInterval(interval); interval=null; } }
  document.addEventListener('pointerdown', e=>{ const el=e.target.closest('.gift'); if(!el) return; select(el); S.holdTimer=setTimeout(()=>startHold(el),180); });
  document.addEventListener('pointerup', e=>{ clearTimeout(S.holdTimer); const el=e.target.closest('.gift'); if(!el) return; if(!pressing) sendOne(el); stopHold(); });
  document.addEventListener('pointerleave', ()=>{ clearTimeout(S.holdTimer); stopHold(); });
}

/*** WALLET ***/
function bindWallet(){
  EL.btnTopup.addEventListener('click', ()=>{ S.regular+=100; save(); updateUI(); toast('+100 BuzzCoins'); });
  let cool=false;
  EL.btnWatchAd.addEventListener('click', ()=>{
    const today=new Date().toISOString().slice(0,10);
    if(S.lastAdDate!==today){ S.adsToday=0; S.lastAdDate=today; }
    if(S.adsToday>=5){ toast('Daily ad limit reached'); return; }
    if(cool){ toast('Please wait 5sâ€¦'); return; }
    S.ad+=1; S.adsToday+=1; save(); updateUI(); toast('+1 from Ad');
    cool=true; EL.btnWatchAd.disabled=true; setTimeout(()=>{ cool=false; EL.btnWatchAd.disabled=false; }, 5000);
  });
}

/*** NAVIGATION ***/
function show(id){ Object.values(EL.screens).forEach(s=>s.classList.remove('active')); EL.screens[id].classList.add('active'); }
function mountNav(){
  const nav=document.createElement('nav'); nav.className='nav';
  nav.innerHTML=`<a class="item" data-go="home"><div>ğŸ </div><div>Home</div></a>
  <a class="item" data-go="gifts"><div>ğŸ</div><div>Gifts</div></a>
  <button class="honeypot" title="Go Live"></button>
  <a class="item" data-go="wallet"><div>ğŸ’°</div><div>Wallet</div></a>
  <a class="item" data-go="profile"><div>ğŸ‘¤</div><div>Profile</div></a>`;
  document.body.appendChild(nav);
  nav.addEventListener('click', e=>{ const a=e.target.closest('[data-go]'); if(!a) return; show(a.getAttribute('data-go')); });
  document.querySelector('.honeypot').addEventListener('click', ()=>toast('Go Live (demo) â€” honeypot button!'));
}

/*** INIT ***/
function init(){ load(); updateUI(); mountGifts(); bindGifting(); bindWallet(); mountNav(); }
init();
</script>
</body>
</html>