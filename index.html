<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>BuzzPi ‚Äî Demo (Alive Gifts ‚Ä¢ Safe Build)</title>
<meta name="theme-color" content="#0b0b0f" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<style>
  :root{--bg:#fff;--fg:#0e0e12;--muted:#68707a;--card:#f7f8fa;--gold:#f7c948;--gold2:#e8b12e;--accent:#7b5df9;--ring:0 6px 18px rgba(0,0,0,.12)}
  @media (prefers-color-scheme: dark){:root{--bg:#0b0b0f;--fg:#eef0f3;--muted:#98a0aa;--card:#111318;--ring:0 8px 24px rgba(0,0,0,.45)}}
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .app{max-width:800px;margin:0 auto;padding-bottom:96px}
  header{position:sticky;top:0;z-index:30;background:var(--bg);padding:12px 16px;border-bottom:1px solid rgba(127,127,127,.15)}
  .row{display:flex;gap:12px;align-items:center;justify-content:space-between}
  .logo{display:flex;gap:10px;align-items:center;font-weight:800}
  .logo-badge{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--gold),var(--gold2));box-shadow:var(--ring)}
  .tabs{display:flex;gap:8px;overflow:auto;padding:10px 16px}
  .chip{flex:0 0 auto;padding:8px 12px;border-radius:999px;background:var(--card);font-weight:600;color:var(--muted)}
  .chip.active{background:linear-gradient(135deg,#5b35f6,#7b5df9);color:#fff}
  .screen{display:none;padding:12px 16px}.screen.active{display:block}
  .card{background:var(--card);border-radius:16px;padding:16px;box-shadow:var(--ring);margin-bottom:14px}
  .coins{font-size:28px;font-weight:800}.muted{color:var(--muted);font-size:13px}
  .btn{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(135deg,#5b35f6,#7b5df9);color:#fff;border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
  .btn.gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:#212121}
  .rowBtns{display:flex;gap:10px;flex-wrap:wrap}.small{font-size:12px}
  .bar{height:10px;background:#1f2330;border-radius:999px;overflow:hidden}.bar>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#5b35f6,#7b5df9)}
  .gsec{margin:18px 0}.gtitle{display:flex;align-items:center;gap:10px;margin:6px 0 10px}.gtitle span{font-weight:800}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}@media (max-width:520px){.grid{grid-template-columns:repeat(3,1fr)}}
  .gift{background:var(--card);border-radius:14px;padding:10px;text-align:center;cursor:pointer;user-select:none;position:relative;box-shadow:var(--ring);transition:.2s}
  .gift .emo{font-size:26px;line-height:1}.gift .name{font-size:11px;color:var(--muted);margin-top:4px}.gift .price{font-size:12px;font-weight:800;margin-top:4px}
  .gift:active{transform:scale(.98)} .gift[data-tier="billionaire"]{outline:2px solid rgba(247,201,72,.25)} .gift[data-tier="rare"]{outline:2px solid rgba(91,53,246,.25)}
  .gift.highlight::after{content:"";position:absolute;inset:-2px;border-radius:16px;box-shadow:0 0 0 0 rgba(123,93,249,.5);animation:heartbeat 1200ms ease-in-out infinite}
  @keyframes heartbeat{0%{transform:scale(1);box-shadow:0 0 0 0 rgba(123,93,249,.45)}25%{transform:scale(1.02);box-shadow:0 0 0 8px rgba(123,93,249,.15)}50%{transform:scale(1);box-shadow:0 0 0 0 rgba(123,93,249,0)}75%{transform:scale(1.02);box-shadow:0 0 0 8px rgba(123,93,249,.12)}100%{transform:scale(1);box-shadow:0 0 0 0 rgba(123,93,249,0)}}
  .stage{position:fixed;inset:0;pointer-events:none;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .combo{position:fixed;top:18%;left:50%;transform:translateX(-50%);font-weight:900;font-size:28px;background:linear-gradient(135deg,#5b35f6,#7b5df9);color:#fff;padding:6px 12px;border-radius:12px;box-shadow:var(--ring);opacity:0;animation:combo .3s ease forwards}
  @keyframes combo{to{opacity:1;transform:translateX(-50%) scale(1.05)}}
  .pop{position:absolute;font-size:64px;animation:pop .6s ease-out forwards}
  @keyframes pop{0%{transform:scale(.5);opacity:.0}40%{transform:scale(1.1);opacity:1}100%{transform:scale(1) translateY(-120px);opacity:0}}
  .spark{position:absolute;width:6px;height:6px;border-radius:50%;background:radial-gradient(circle,#fff,#ffd);animation:spark 800ms ease-out forwards}
  @keyframes spark{from{transform:translate(0,0);opacity:1}to{transform:translate(var(--dx),var(--dy));opacity:0}}
  /* (Alive anim CSS trimmed for brevity; same as previous build) */
  /* Butterfly */
  .bfly{position:absolute;width:64px;height:64px;transform-origin:center;animation:bfFloat 1s ease-in-out forwards}
  .bf-body{position:absolute;left:30px;top:20px;width:6px;height:24px;background:#3b2a22;border-radius:6px}
  .wing{position:absolute;width:28px;height:28px;border-radius:50% 45% 50% 45%;background:radial-gradient(circle at 30% 30%,#ffb6c1,#ff69b4);opacity:.95;transform-origin:28px 14px;filter:drop-shadow(0 2px 6px rgba(0,0,0,.25))}
  .wing.left{left:10px;top:12px;transform:rotateZ(12deg);animation:flap .25s ease-in-out infinite alternate}
  .wing.right{left:28px;top:12px;transform:scaleX(-1) rotateZ(12deg);animation:flap .25s ease-in-out infinite alternate}
  @keyframes flap{from{transform:rotateZ(6deg)}to{transform:rotateZ(26deg)}}@keyframes bfFloat{0%{transform:translate(-20px,40px) rotate(-8deg);opacity:0}20%{opacity:1}50%{transform:translate(0px,-10px) rotate(5deg)}100%{transform:translate(120px,-60px) rotate(12deg);opacity:0}}
  /* Car */
  .car{position:absolute;width:120px;height:52px;transform-origin:center;animation:carEnter .45s ease-out forwards,carExit .6s ease-in forwards .6s}
  .car-body{position:absolute;left:10px;right:10px;top:10px;bottom:10px;border-radius:12px;background:linear-gradient(135deg,#18a558,#0b7a44);box-shadow:0 6px 12px rgba(0,0,0,.3)}
  .car-body.hummer{background:linear-gradient(135deg,#c8a045,#a67c22)}.wheel{position:absolute;bottom:2px;width:22px;height:22px;border-radius:50%;background:radial-gradient(circle at 35% 35%,#000,#222);border:3px solid #444;animation:spin .5s linear infinite}
  .wheel::after{content:"";position:absolute;left:50%;top:50%;width:8px;height:8px;transform:translate(-50%,-50%);background:#888;border-radius:50%}
  .wheel.l{left:14px}.wheel.r{right:14px}@keyframes carEnter{from{transform:translateX(-160px) rotate(-12deg)}to{transform:translateX(0) rotate(-2deg)}}@keyframes carExit{to{transform:translateX(240px) rotate(3deg);opacity:0}}@keyframes spin{to{transform:rotate(360deg)}}
  .smoke{position:absolute;bottom:8px;left:2px;width:10px;height:10px;border-radius:50%;background:radial-gradient(circle,#fff,#bbb0);filter:blur(1px);animation:puff .6s ease-out forwards}
  @keyframes puff{to{transform:translate(-24px,-10px) scale(1.8);opacity:0}}
  /* Party, Lick, etc. (unchanged) */
  .party{position:absolute;width:120px;height:120px;animation:partyUp 1s ease-out forwards}@keyframes partyUp{from{transform:translateY(40px);opacity:0}20%{opacity:1}to{transform:translateY(-40px);opacity:0}}
  .horn{position:absolute;left:46px;top:52px;width:28px;height:10px;background:linear-gradient(90deg,#fdd835,#f06292);border-radius:10px;transform-origin:left center;animation:hornUnroll .7s ease-out forwards}
  @keyframes hornUnroll{from{transform:scaleX(.2) rotate(-10deg)}to{transform:scaleX(1.2) rotate(8deg)}}
  .conf{position:absolute;width:6px;height:10px;border-radius:2px;animation:confDrop 900ms ease-out forwards}
  @keyframes confDrop{from{transform:translateY(-10px) rotate(0)}to{transform:translateY(80px) rotate(240deg);opacity:0}}
  .lick{position:absolute;width:120px;height:120px}.mouth{position:absolute;left:42px;top:54px;width:36px;height:22px;background:#111;border-radius:0 0 18px 18px;overflow:hidden}
  .tongue{position:absolute;left:-10px;top:6px;width:30px;height:14px;background:#e26d77;border-radius:14px;animation:lick 800ms ease-out forwards}
  @keyframes lick{0%{transform:translateX(0)}40%{transform:translateX(42px)}70%{transform:translateX(42px)}100%{transform:translateX(0)}}
  .rose{display:none} /* (petals are separate elements) */
  .petal{position:absolute;width:10px;height:14px;background:radial-gradient(circle at 30% 30%,#ff8aa1,#e6406f);border-radius:10px 10px 2px 10px;transform:rotate(20deg);opacity:.95;animation:fall 900ms ease-in forwards}
  @keyframes fall{from{transform:translateY(-20px) rotate(20deg)}to{transform:translateY(120px) rotate(60deg);opacity:0}}
  .bubble{position:absolute;width:8px;height:8px;border-radius:50%;background:radial-gradient(circle,#fff,#fff0);border:1px solid #fff8;animation:rise 900ms ease-out forwards}
  @keyframes rise{from{transform:translateY(0) scale(.6);opacity:.8}to{transform:translateY(-120px) scale(1.1);opacity:0}}
  .clink{position:absolute;width:16px;height:16px;border-radius:50%;border:2px solid #fff8;animation:clinkPop 500ms ease-out forwards}
  @keyframes clinkPop{from{transform:scale(.4);opacity:.8}to{transform:scale(1.6);opacity:0}}
  .shock{position:absolute;width:2px;height:14px;background:#fff8;animation:shockOut 400ms ease-out forwards}
  @keyframes shockOut{from{transform:scaleY(.4);opacity:.9}to{transform:scaleY(1.4) translateY(-14px);opacity:0}}
  .kiss{position:absolute;font-size:42px;animation:kissUp 800ms ease-out forwards}
  @keyframes kissUp{from{transform:translateY(20px);opacity:.2}to{transform:translateY(-80px);opacity:0}}
  .coin{position:absolute;width:14px;height:14px;border-radius:50%;background:radial-gradient(circle,#ffd54f,#fbc02d);box-shadow:0 1px 2px rgba(0,0,0,.25);animation:coinFall 900ms ease-in forwards}
  @keyframes coinFall{from{transform:translateY(-40px) rotate(0)}to{transform:translateY(120px) rotate(360deg);opacity:0}}
  .flash{position:fixed;inset:0;background:#fff8;animation:flash 180ms ease-out forwards}
  @keyframes flash{from{opacity:1}to{opacity:0}}.bolt{position:absolute;width:4px;height:120px;background:linear-gradient(#fff,#fff0);transform:skewX(-20deg);animation:boltDrop 280ms ease-out forwards}
  @keyframes boltDrop{from{transform:translateY(-60px) skewX(-20deg)}to{transform:translateY(40px) skewX(-20deg);opacity:0}}
  .rainbow{position:absolute;width:220px;height:110px;border-radius:110px 110px 0 0;background:conic-gradient(from 180deg,red,orange,yellow,green,blue,indigo,violet,red);mask:radial-gradient(110px 70px at 50% 100%,transparent 60%,black 61%);animation:rb 1.2s ease-out forwards}
  @keyframes rb{from{transform:translateX(-160px);opacity:.2}to{transform:translateX(160px);opacity:0}}
  .flake{position:absolute;width:10px;height:10px;background:radial-gradient(circle,#fff,#fff0);border-radius:50%;animation:flake 1200ms ease-in forwards}
  @keyframes flake{from{transform:translate(-20px,-20px)}to{transform:translate(40px,120px);opacity:0}}
  .sun{position:absolute;width:80px;height:80px;border-radius:50%;background:radial-gradient(circle,#fff59d,#ffeb3b);box-shadow:0 0 20px #ffeb3b88;animation:sunUp 1s ease-out forwards}
  .ray{position:absolute;width:4px;height:24px;background:#ffe082;top:-12px;left:50%;transform-origin:50% 52px;opacity:.9}
  @keyframes sunUp{from{transform:translateY(40px);opacity:0}to{transform:translateY(-20px);opacity:0}}
  .crown{position:absolute;width:90px;height:60px;background:linear-gradient(180deg,#f7c948,#d2a21d);clip-path:polygon(0% 60%,15% 0,30% 60%,50% 0,70% 60%,85% 0,100% 60%,100% 100%,0% 100%);animation:crown 900ms ease-out forwards}
  @keyframes crown{from{transform:translateY(-80px) rotate(-10deg);opacity:.2}to{transform:translateY(40px) rotate(6deg);opacity:0}}
  .plane{position:absolute;width:120px;height:36px;border-radius:6px;background:linear-gradient(135deg,#b3e5fc,#90caf9);box-shadow:0 4px 10px rgba(0,0,0,.25);animation:fly 1s ease-in-out forwards}
  .trail{position:absolute;width:140px;height:6px;background:linear-gradient(90deg,#fff8,#fff0);border-radius:6px;top:18px;left:-140px;animation:trail 1s ease-out forwards}
  @keyframes fly{from{transform:translateX(-200px) translateY(40px) rotate(-6deg);opacity:.2}to{transform:translateX(200px) translateY(-40px) rotate(4deg);opacity:0}}
  @keyframes trail{from{opacity:.8}to{opacity:0}}
  .yacht{position:absolute;width:140px;height:40px;background:linear-gradient(180deg,#e0f7fa,#b2ebf2);border-radius:0 0 16px 16px;animation:float 1.2s ease-in-out forwards}
  .wave{position:absolute;width:200px;height:40px;background:radial-gradient(circle,#90caf9,#90caf900);bottom:-8px;left:-30px;filter:blur(4px);animation:wave 1s ease-out forwards}
  @keyframes float{from{transform:translateY(20px) rotate(-2deg);opacity:.4}50%{transform:translateY(-6px) rotate(2deg);opacity:1}to{transform:translateY(30px);opacity:0}}
  @keyframes wave{from{opacity:.6}to{opacity:0}}
  .phoenix{position:absolute;width:90px;height:90px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#ff9800,#f44336);box-shadow:0 0 30px #ff7043aa;animation:ph 1s ease-out forwards}
  .flame{position:absolute;width:10px;height:24px;background:radial-gradient(circle,#ffa726,#ff7043);border-radius:6px 6px 16px 16px;filter:blur(.6px);animation:flick .3s ease-in-out infinite alternate}
  @keyframes ph{from{transform:translateX(-120px) scale(.8);opacity:.4}50%{opacity:1}to{transform:translateX(160px) scale(1);opacity:0}}
  @keyframes flick{from{transform:translateY(0) rotate(-6deg)}to{transform:translateY(-6px) rotate(6deg)}}
  .trailStar{position:absolute;width:8px;height:8px;background:radial-gradient(circle,#fff,#fff0);border-radius:50%;animation:tstar 600ms ease-out forwards}
  @keyframes tstar{from{transform:scale(.8);opacity:.8}to{transform:scale(1.6) translateY(-40px);opacity:0}}
  .castle{position:absolute;width:120px;height:80px;background:linear-gradient(180deg,#e3f2fd,#bbdefb);clip-path:polygon(0% 100%,0% 30%,20% 30%,20% 0%,34% 0%,34% 30%,66% 30%,66% 0%,80% 0%,80% 30%,100% 30%,100% 100%);box-shadow:0 4px 10px rgba(0,0,0,.25);animation:rise 1s ease-out forwards}
  @keyframes rise{from{transform:translateY(80px);opacity:.2}to{transform:translateY(-20px);opacity:0}}
  .chest{position:absolute;width:120px;height:60px;background:#6d4c41;border-radius:6px;box-shadow:0 4px 10px rgba(0,0,0,.25);animation:chest 900ms ease-out forwards}
  .gold{position:absolute;width:10px;height:10px;border-radius:50%;background:radial-gradient(circle,#ffd54f,#fbc02d);animation:goldUp 700ms ease-out forwards}
  @keyframes chest{from{transform:translateY(40px)}to{transform:translateY(-10px);opacity:0}}
  @keyframes goldUp{from{transform:translateY(0)}to{transform:translateY(-80px);opacity:0}}

  .nav{position:fixed;bottom:0;left:0;right:0;background:var(--bg);border-top:1px solid rgba(127,127,127,.15);display:flex;justify-content:space-around;align-items:center;padding:10px 8px 14px}
  .nav .item{display:flex;flex-direction:column;align-items:center;font-size:11px;color:var(--muted);text-decoration:none}
  .honeypot{position:relative;top:-22px;width:68px;height:68px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff8,transparent),linear-gradient(135deg,#fce38a,#f38181);box-shadow:0 10px 30px rgba(243,129,129,.35), inset 0 0 0 4px rgba(255,255,255,.35);display:flex;align-items:center;justify-content:center;border:0}
  .honeypot:after{content:"üçØ";font-size:28px}.honeypot:active{transform:scale(.97)}
  .toast{position:fixed;bottom:92px;left:50%;transform:translateX(-50%);background:#111c;border:1px solid #fff2;color:#fff;padding:10px 14px;border-radius:10px;backdrop-filter:blur(8px);font-size:13px;opacity:0;transition:.25s}
  .toast.show{opacity:1}
  .footerNote{opacity:.6;text-align:center;font-size:11px;margin:20px 0}
  .err{position:fixed;top:8px;left:50%;transform:translateX(-50%);background:#ff3b30cc;color:#fff;padding:8px 12px;border-radius:10px;font-size:12px;z-index:50;display:none}
</style>
</head>
<body>
<div class="err" id="err"></div>

<div class="app">
  <header>
    <div class="row">
      <div class="logo"><div class="logo-badge"></div> BuzzPi</div>
      <div class="coins" id="balance">0</div>
    </div>
    <div class="tabs" id="topTabs">
      <div class="chip active">Following</div><div class="chip">Popular</div><div class="chip">Nearby</div><div class="chip">Newcomers</div><div class="chip">Trending</div>
    </div>
  </header>

  <section class="screen active" id="scrHome">
    <div class="card"><div style="display:flex;justify-content:space-between;align-items:center">
      <div><div style="font-weight:800">Welcome to BuzzPi (Demo)</div>
      <div class="muted">Tap the Gifts tab to try <b>alive</b> animations & coin flow.</div></div>
      <div class="muted small">Theme-adaptive ‚úì</div>
    </div></div>
  </section>

  <section class="screen" id="scrGifts">
    <div class="gsec"><div class="gtitle"><span>Common</span><small class="muted">1‚Äì20 BuzzCoins</small></div><div class="grid" id="gridCommon"></div></div>
    <div class="gsec"><div class="gtitle"><span>Rare</span><small class="muted">50‚Äì500 BuzzCoins</small></div><div class="grid" id="gridRare"></div></div>
    <div class="gsec"><div class="gtitle"><span>Billionaire</span><small class="muted">1,000‚Äì10,000 BuzzCoins</small></div><div class="grid" id="gridBillion"></div></div>
  </section>

  <section class="screen" id="scrWallet">
    <div class="card">
      <div class="coins"><span id="cRegular">0</span> <span class="muted">BuzzCoins</span></div>
      <div class="muted">Ad-earned balance: <b id="cAd">0</b> (gifting only)</div>
      <div class="muted small" id="adInfo"></div>
      <div class="rowBtns" style="margin-top:12px">
        <button class="btn gold" id="btnTopup">Top up +100</button>
        <button class="btn" id="btnWatchAd">Watch Ad (+1)</button>
      </div>
      <div class="muted small" style="margin-top:8px">Ad limit: 5/day ‚Ä¢ 5s cooldown</div>
    </div>
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><div style="font-weight:800">Level <span id="level">1</span></div>
        <div class="muted">Spend 500 coins on gifts to level up</div></div>
        <div class="muted small">Progress: <b id="lvPct">0%</b></div>
      </div>
      <div class="bar" style="margin-top:12px"><i id="lvBar"></i></div>
      <div class="muted small" id="lvHint" style="margin-top:8px"></div>
    </div>
  </section>

  <section class="screen" id="scrProfile">
    <div class="card"><div style="display:flex;gap:12px;align-items:center">
      <div class="logo-badge" style="width:44px;height:44px;border-radius:12px"></div>
      <div><div style="font-weight:800">You (Demo)</div><div class="muted small">Ranked badge & frames appear here later.</div></div>
    </div></div>
    <div class="card"><div style="font-weight:800;margin-bottom:8px">Stealth Mode (Phase 2)</div>
      <div class="muted small">Face mask + voice modulation will be here in Phase 2.</div>
    </div>
  </section>

  <div class="footerNote">If something looks stuck, refresh with <code>?v=3</code> to bust cache.</div>
</div>

<div class="stage" id="stage"></div>
<div class="toast" id="toast"></div>

<script>
/* ---------- SAFETY & HELPERS ---------- */
function $(sel){return document.querySelector(sel)}
function el(tag,cls){const d=document.createElement(tag); if(cls) d.className=cls; return d}
function showToast(msg,ms=1400){const t=$('#toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),ms)}
function showErr(msg){const e=$('#err');e.textContent=msg; e.style.display='block'; setTimeout(()=>e.style.display='none',4000)}
window.onerror = (m,src,l,c,e)=>{showErr('JS error: '+(e?.message||m));};
window.onunhandledrejection = (ev)=>{showErr('Promise error: '+(ev?.reason?.message||ev?.reason||'unknown'));};

/* ---------- STATE ---------- */
const S={regular:300,ad:0,spent:0,adsToday:0,lastAdDate:null,holdTimer:null};
function save(){localStorage.setItem('buzz_demo_safe',JSON.stringify(S))}
function load(){try{Object.assign(S,JSON.parse(localStorage.getItem('buzz_demo_safe')||'{}'))}catch(_){}}

/* ---------- UI BIND ---------- */
const EL={
  screens:{home:$('#scrHome'),gifts:$('#scrGifts'),wallet:$('#scrWallet'),profile:$('#scrProfile')},
  balance:$('#balance'),cRegular:$('#cRegular'),cAd:$('#cAd'),adInfo:$('#adInfo'),
  btnTopup:$('#btnTopup'),btnWatchAd:$('#btnWatchAd'),
  level:$('#level'),lvBar:$('#lvBar'),lvPct:$('#lvPct'),lvHint:$('#lvHint'),
  gridCommon:$('#gridCommon'),gridRare:$('#gridRare'),gridBillion:$('#gridBillion'),
  stage:$('#stage')
};
function fmt(n){return n.toLocaleString()}
function updateUI(){
  $('#balance').textContent=fmt(S.regular+S.ad);
  $('#cRegular').textContent=fmt(S.regular); $('#cAd').textContent=fmt(S.ad);
  const today=new Date().toISOString().slice(0,10);
  if(S.lastAdDate!==today){S.adsToday=0;S.lastAdDate=today;save()}
  $('#adInfo').textContent=`Ads watched today: ${S.adsToday}/5`;
  const per=500, lvl=Math.min(99,Math.floor(S.spent/per)+1), into=S.spent%per, pct=Math.round(into/per*100);
  $('#level').textContent=lvl; $('#lvPct').textContent=pct+'%'; $('#lvBar').style.width=pct+'%';
  $('#lvHint').textContent=`${fmt(per-into)} coins to Level ${Math.min(99,lvl+1)}`;
}
function spend(amount){
  if(amount>S.regular+S.ad) return false;
  const useAd=Math.min(S.ad,amount); S.ad-=useAd; S.regular-= (amount-useAd); S.spent+=amount; save(); updateUI(); return true;
}

/* ---------- GIFTS DATA ---------- */
const gifts={
  common:[
    {emoji:'ü•≥',name:'Party',price:1,anim:'party'},{emoji:'ü•∞',name:'Hearts',price:1,anim:'sparkle'},
    {emoji:'üòç',name:'Love Eyes',price:1,anim:'sparkle'},{emoji:'üòã',name:'Yum',price:1,anim:'lick'},
    {emoji:'ü§ó',name:'Hug',price:1,anim:'sparkle'},{emoji:'ü§©',name:'Starry',price:1,anim:'sparkle'},
    {emoji:'ü§ë',name:'Cashy',price:1,anim:'coins'},{emoji:'üç≠',name:'Lollipop',price:2,anim:'sparkle'},
    {emoji:'üç¨',name:'Candy',price:2,anim:'sparkle'},{emoji:'üç´',name:'Chocolate',price:2,anim:'sparkle'},
    {emoji:'üç∏',name:'Cocktail',price:5,anim:'sparkle'},{emoji:'üçé',name:'Apple',price:5,anim:'sparkle'},
    {emoji:'üç∫',name:'Beer',price:5,anim:'sparkle'},{emoji:'üåπ',name:'Rose',price:10,anim:'petals'},
    {emoji:'üå∏',name:'Blossom',price:10,anim:'rose'},{emoji:'‚ú®',name:'Sparkle',price:10,anim:'sparkle'},
    {emoji:'üíê',name:'Bouquet',price:20,anim:'rose'},{emoji:'üçª',name:'Cheers',price:20,anim:'clink'},
    {emoji:'üëè',name:'Clap',price:20,anim:'clap'},{emoji:'üíã',name:'Kiss',price:20,anim:'kiss'}
  ],
  rare:[
    {emoji:'ü¶ã',name:'Butterfly',price:50,anim:'Butterfly flap'},{emoji:'üå©',name:'Storm',price:50,anim:'storm'},
    {emoji:'üå§',name:'Sunrise',price:50,anim:'sun'},{emoji:'üåà',name:'Rainbow',price:50,anim:'rainbow horizon'},
    {emoji:'‚ùÑÔ∏è',name:'Snow',price:50,anim:'snow flakes'},{emoji:'üß∏',name:'Teddy',price:100,anim:'wiggling'},
    {emoji:'üêá',name:'Bunny',price:100,anim:'hop'},{emoji:'üçæ',name:'Champagne',price:100,anim:'pop'},
    {emoji:'üëë',name:'Crown',price:100,anim:'sparkle'},{emoji:'üç∑',name:'Wine',price:100,anim:'swirling'},
    {emoji:'ü•Ç',name:'Toast',price:100,anim:'clink'},{emoji:'üèéÔ∏è',name:'Jade Lamborghini',price:500,anim:'car'},
    {emoji:'‚úàÔ∏è',name:'Crystal Aeroplane',price:500,anim:'plane'},{emoji:'üöô',name:'Golden Hummer',price:500,anim:'hummer'},
    {emoji:'üõ•Ô∏è',name:'Yacht',price:500,anim:'yacht'}
  ],
  billionaire:[
    {emoji:'üî•üïäÔ∏è',name:'Fiery Phoenix',price:1000,anim:'phoenix'},{emoji:'ü¶Ñ',name:'Racing Unicorn',price:1000,anim:'unicorn'},
    {emoji:'üè∞',name:'Crystal Castle',price:1000,anim:'castle'},{emoji:'üí∞',name:'Treasure Chest',price:1000,anim:'chest'},
    {emoji:'üèØ‚òÅÔ∏è',name:'Mansion in the Sky',price:5000,anim:'castle'},{emoji:'üßú‚Äç‚ôÄÔ∏è',name:'Mermaid',price:5000,anim:'sparkle'},
    {emoji:'üíò',name:'Cupids',price:5000,anim:'sparkle'},{emoji:'üßù‚Äç‚ôÄÔ∏è',name:'Elf Queen',price:5000,anim:'sparkle'},
    {emoji:'üõ©Ô∏è‚ú®',name:'Golden Private Jet',price:10000,anim:'plane'},{emoji:'üíé‚åö',name:'Diamond Rolex',price:10000,anim:'sparkle'},
    {emoji:'üêéüöó',name:'Chariots of Horses',price:10000,anim:'unicorn'}
  ]
};

/* ---------- RENDER ---------- */
function giftEl(g){const el=elDiv('gift'); el.dataset.price=g.price; el.dataset.anim=g.anim||''; el.dataset.name=g.name; el.innerHTML=`<div class="emo">${g.emoji}</div><div class="name">${g.name}</div><div class="price">${fmt(g.price)}ü™ô</div>`; return el}
function elDiv(cls){const d=document.createElement('div'); d.className=cls; return d}
function mountGifts(){
  gifts.common.forEach(g=>EL.gridCommon.appendChild(giftEl(g)));
  gifts.rare.forEach(g=>{const e=giftEl(g); e.dataset.tier='rare'; EL.gridRare.appendChild(e)});
  gifts.billionaire.forEach(g=>{const e=giftEl(g); e.dataset.tier='billionaire'; EL.gridBillion.appendChild(e)});
}

/* ---------- ANIM DISPATCH (wrapped in try/catch) ---------- */
function center(){return {x:innerWidth/2,y:innerHeight/2}}
function add(node,ms=1000){EL.stage.appendChild(node); setTimeout(()=>node.remove(),ms)}
function safe(fn){try{fn()}catch(e){showErr(e.message||'Anim error')}}
function runAnim(key, emoji){
  const map={
    party:anim_party, lick:anim_lick, butterfly:anim_butterfly, car:()=>anim_car(false), hummer:()=>anim_car(true),
    rose:anim_rose, champagne:anim_champagne, clink:anim_clink, clap:anim_clap, kiss:anim_kiss, coins:anim_coins,
    storm:anim_storm, rainbow:anim_rainbow, snow:anim_snow, sun:anim_sun, crown:anim_crown,
    plane:()=>anim_plane(false), yacht:anim_yacht, phoenix:anim_phoenix, unicorn:anim_unicorn, castle:anim_castle, chest:anim_chest,
    sparkle:anim_sparkle
  };
  safe(()=> (map[key]||(()=>fallback(emoji)))() );
}

/* ---------- (Anim functions ‚Äì same as previous; trimmed here) ---------- */
function fallback(emoji){const p=el('div','pop');const {x,y}=center();p.textContent=emoji;p.style.left=(x-28)+'px';p.style.top=(y-28)+'px';EL.stage.appendChild(p);for(let i=0;i<10;i++){const s=el('div','spark');s.style.left=x+'px';s.style.top=y+'px';s.style.setProperty('--dx',((Math.random()*2-1)*140|0)+'px');s.style.setProperty('--dy',(-60-Math.random()*120|0)+'px');EL.stage.appendChild(s);setTimeout(()=>s.remove(),800)}setTimeout(()=>p.remove(),620)}
function anim_party(){const box=el('div','party');const {x,y}=center();box.style.left=(x-60)+'px';box.style.top=(y-60)+'px';const horn=el('div','horn');box.appendChild(horn);for(let i=0;i<18;i++){const c=el('div','conf');c.style.left=(50+Math.random()*40-20)+'px';c.style.top=(40+Math.random()*10-5)+'px';c.style.background=['#f44336','#ff9800','#ffeb3b','#4caf50','#2196f3','#9c27b0'][i%6];c.style.animationDelay=(i*30)+'ms';box.appendChild(c)}add(box,1000)}
function anim_lick(){const b=el('div','lick');const {x,y}=center();b.style.left=(x-60)+'px';b.style.top=(y-60)+'px';const m=el('div','mouth');const t=el('div','tongue');m.appendChild(t);b.appendChild(m);add(b,900)}
function anim_butterfly(){const {x,y}=center();const r=el('div','bfly');r.style.left=(x-32)+'px';r.style.top=y+'px';r.innerHTML='<div class="bf-body"></div><div class="wing left"></div><div class="wing right"></div>';add(r,1000)}
function anim_car(){const {x,y}=center();const car=el('div','car');car.style.left=(x-60)+'px';car.style.top=y+'px';car.innerHTML='<div class="car-body"></div><div class="wheel l"></div><div class="wheel r"></div>';for(let i=0;i<3;i++){const s=el('div','smoke');s.style.left=(x-30)+'px';s.style.top=(y+20)+'px';s.style.animationDelay=(i*120)+'ms';add(s,600+i*120)}add(car,1400)}
function anim_rose(){const {x,y}=center();for(let i=0;i<12;i++){const p=el('div','petal');p.style.left=(x+(Math.random()*120-60))+'px';p.style.top=(y+(Math.random()*-30-10))+'px';p.style.animationDelay=(i*40)+'ms';add(p,1000+i*40)}}
function anim_champagne(){const {x,y}=center();for(let i=0;i<14;i++){const b=el('div','bubble');b.style.left=(x+(Math.random()*50-25))+'px';b.style.top=(y+20+(Math.random()*20-10))+'px';b.style.animationDelay=(i*40)+'ms';add(b,1000+i*40)}}
function anim_clink(){const {x,y}=center();for(let i=0;i<6;i++){const c=el('div','clink');c.style.left=(x+(Math.random()*30-15))+'px';c.style.top=(y+(Math.random()*-10-10))+'px';c.style.animationDelay=(i*50)+'ms';add(c,500+i*50)}}
function anim_clap(){const {x,y}=center();for(let i=0;i<6;i++){const s=el('div','shock');s.style.left=(x+(i*8-20))+'px';s.style.top=(y-6)+'px';add(s,420)}}
function anim_kiss(){const {x,y}=center();for(let i=0;i<6;i++){const k=el('div','kiss');k.textContent='üíã';k.style.left=(x+(Math.random()*40-20))+'px';k.style.top=(y+10)+'px';k.style.animationDelay=(i*60)+'ms';add(k,900+i*60)}}
function anim_coins(){const {x,y}=center();for(let i=0;i<20;i++){const c=el('div','coin');c.style.left=(x+(Math.random()*120-60))+'px';c.style.top=(y-40+(Math.random()*20-10))+'px';c.style.animationDelay=(i*30)+'ms';add(c,900+i*30)}}
function anim_sparkle(){const {x,y}=center();for(let i=0;i<10;i++){const s=el('div','spark');s.style.left=x+'px';s.style.top=y+'px';s.style.setProperty('--dx',((Math.random()*2-1)*140|0)+'px');s.style.setProperty('--dy',(-60-Math.random()*120|0)+'px');add(s,800)}}
function anim_storm(){add(el('div','flash'),180);const {x,y}=center();for(let i=0;i<3;i++){const b=el('div','bolt');b.style.left=(x+(i*16-24))+'px';b.style.top=(y-40)+'px';add(b,280)}}
function anim_rainbow(){const r=el('div','rainbow');const {x,y}=center();r.style.left=(x-110)+'px';r.style.top=(y-80)+'px';add(r,1200)}
function anim_snow(){const {x,y}=center();for(let i=0;i<14;i++){const f=el('div','flake');f.style.left=(x+(Math.random()*80-40))+'px';f.style.top=(y-40)+'px';add(f,1200)}}
function anim_sun(){const {x,y}=center();const s=el('div','sun');s.style.left=(x-40)+'px';s.style.top=(y-40)+'px';for(let i=0;i<12;i++){const r=el('div','ray');r.style.transform=`rotate(${i*30}deg)`;s.appendChild(r)}add(s,1000)}
function anim_crown(){const c=el('div','crown');const {x,y}=center();c.style.left=(x-45)+'px';c.style.top=(y-60)+'px';add(c,900)}
function anim_plane(){const {x,y}=center();const p=el('div','plane');p.style.left=(x-60)+'px';p.style.top=y+'px';const t=el('div','trail');p.appendChild(t);add(p,1000)}
function anim_yacht(){const {x,y}=center();const yb=el('div','yacht');yb.style.left=(x-70)+'px';yb.style.top=y+'px';yb.appendChild(el('div','wave'));add(yb,1200)}
function anim_phoenix(){const {x,y}=center();const ph=el('div','phoenix');ph.style.left=(x-45)+'px';ph.style.top=(y-45)+'px';for(let i=0;i<6;i++){const fl=el('div','flame');fl.style.left=(10+i*12)+'px';fl.style.top='56px';fl.style.animationDelay=(i*80)+'ms';ph.appendChild(fl)}add(ph,1000)}
function anim_unicorn(){const {x,y}=center();for(let i=0;i<10;i++){const t=el('div','trailStar');t.style.left=(x-60+i*12)+'px';t.style.top=(y-10-Math.random()*20)+'px';add(t,600)}}
function anim_castle(){const {x,y}=center();const c=el('div','castle');c.style.left=(x-60)+'px';c.style.top=(y-40)+'px';add(c,1000)}
function anim_chest(){const {x,y}=center();const ch=el('div','chest');ch.style.left=(x-60)+'px';ch.style.top=(y-20)+'px';add(ch,900);for(let i=0;i<14;i++){const g=el('div','gold');g.style.left=(x+(Math.random()*80-40))+'px';g.style.top=y+'px';g.style.animationDelay=(i*40)+'ms';add(g,700+i*40)}}

/* ---------- INTERACTION ---------- */
function show(id){Object.values(EL.screens).forEach(s=>s.classList.remove('active')); EL.screens[id].classList.add('active')}
function mountNav(){
  const nav=el('nav','nav'); nav.innerHTML=`<a class="item" data-go="home"><div>üè†</div><div>Home</div></a>
  <a class="item" data-go="gifts"><div>üéÅ</div><div>Gifts</div></a>
  <button class="honeypot" title="Go Live"></button>
  <a class="item" data-go="wallet"><div>üí∞</div><div>Wallet</div></a>
  <a class="item" data-go="profile"><div>üë§</div><div>Profile</div></a>`;
  document.body.appendChild(nav);
  nav.addEventListener('click',e=>{const a=e.target.closest('[data-go]'); if(!a) return; show(a.getAttribute('data-go'))});
  nav.querySelector('.honeypot').addEventListener('click',()=>showToast('Go Live (demo) ‚Äî honeypot button!'));
}
function showCombo(n){const c=el('div','combo'); c.textContent='Combo x'+n; document.body.appendChild(c); setTimeout(()=>c.remove(),600)}
function sendOne(giftEl){
  const price=+giftEl.dataset.price; const emoji=giftEl.querySelector('.emo').textContent; const anim=giftEl.dataset.anim||'';
  if(!spend(price)){showToast('Not enough BuzzCoins'); return false}
  runAnim(anim, emoji); return true;
}
function bindGifting(){
  let combo=0, hold=null, pressing=false, highlighted=null;
  function select(el){ if(highlighted) highlighted.classList.remove('highlight'); highlighted=el; el.classList.add('highlight'); setTimeout(()=>{ if(highlighted===el) el.classList.remove('highlight')},1600)}
  function startHold(el){ pressing=true; combo=0; if(sendOne(el)){ combo=1; showCombo(combo)} hold=setInterval(()=>{ if(sendOne(el)){ combo++; if(combo%2===0) showCombo(combo)} else stopHold()},180)}
  function stopHold(){ pressing=false; clearInterval(hold); hold=null }
  document.addEventListener('pointerdown',e=>{const el=e.target.closest('.gift'); if(!el) return; select(el); S.holdTimer=setTimeout(()=>startHold(el),180)})
  document.addEventListener('pointerup',e=>{clearTimeout(S.holdTimer); const el=e.target.closest('.gift'); if(!el) return; if(!pressing) sendOne(el); stopHold()})
  document.addEventListener('pointerleave',()=>{clearTimeout(S.holdTimer); stopHold()})
}
function bindWallet(){
  $('#btnTopup').addEventListener('click',()=>{S.regular+=100;save();updateUI();showToast('+100 BuzzCoins')})
  let cool=false; $('#btnWatchAd').addEventListener('click',()=>{
    const today=new Date().toISOString().slice(0,10); if(S.lastAdDate!==today){S.adsToday=0;S.lastAdDate=today}
    if(S.adsToday>=5) return showToast('Daily ad limit reached');
    if(cool) return showToast('Please wait 5s‚Ä¶');
    S.ad+=1; S.adsToday+=1; save(); updateUI(); showToast('+1 from Ad');
    cool=true; $('#btnWatchAd').disabled=true; setTimeout(()=>{cool=false; $('#btnWatchAd').disabled=false},5000);
  })
}

/* ---------- BOOT ---------- */
document.addEventListener('DOMContentLoaded', ()=>{
  try{
    load(); updateUI(); mountGifts(); bindGifting(); bindWallet(); mountNav();
  }catch(e){ showErr('Init error: '+(e?.message||e)); }
});
</script>
</body>
</html>