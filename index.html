<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>BuzzPi ‚Äì Gift Lab</title>
<style>
  :root{
    --bg:#0f0f12; --fg:#e6e6ec; --muted:#9aa0a6; --brand:#7c4dff; --accent:#ffd166;
    --card:#17171b; --card2:#1e1f25; --ok:#34d399; --bad:#ef4444; --warn:#f59e0b;
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f7f7fb; --fg:#121219; --muted:#5c6270; --brand:#5b38ff; --accent:#c59000;
           --card:#ffffff; --card2:#f1f2f6; }
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font:16px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial;}
  .app{min-height:100dvh;padding-bottom:92px}
  header{
    position:sticky;top:0;z-index:20;padding:14px 16px 10px;background:
      linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.0)),
      radial-gradient(1200px 300px at 10% -10%, rgba(124,77,255,.2),transparent 60%),
      radial-gradient(1200px 300px at 90% -10%, rgba(255,209,102,.18),transparent 60%);
    backdrop-filter:saturate(130%) blur(4px);
    display:flex;align-items:center;gap:10px;border-bottom:1px solid rgba(255,255,255,.06);
  }
  .logo{width:28px;height:28px;border-radius:6px;background:#f2b84d}
  .brand{font-weight:800;letter-spacing:.2px}
  .tabs{display:flex;gap:10px;margin-top:8px;overflow:auto;padding-bottom:2px}
  .chip{padding:6px 12px;border-radius:14px;background:var(--card2);color:var(--muted);white-space:nowrap;border:1px solid rgba(255,255,255,.06)}
  .chip.active{background:var(--brand);color:white}

  /* Screens */
  .screen{display:none;padding:16px}
  .screen.active{display:block}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:14px 12px;margin-bottom:14px}
  .muted{color:var(--muted)}
  .small{font-size:.9rem}

  /* Grid of gifts */
  .gift-grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
  .gift{background:var(--card2);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:10px 4px;
        text-align:center;cursor:pointer;position:relative;user-select:none;transition:transform .12s ease, box-shadow .12s ease}
  .gift:hover{transform:translateY(-2px)}
  .gift.selected{animation:breathe 1.2s ease-in-out infinite}
  @keyframes breathe{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
  .gift .emo{font-size:26px;display:block}
  .gift .name{font-size:.76rem;margin-top:4px;color:var(--muted)}
  .gift .price{position:absolute;right:6px;top:6px;background:#0009;color:#fff;padding:2px 6px;border-radius:10px;font-size:.7rem}

  /* Overlay for animations */
  .fx-layer{position:fixed;inset:0;pointer-events:none;z-index:30;overflow:hidden}
  .fx-item{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)}

  /* Some reusable effects */
  @keyframes confettiFall{0%{transform:translateY(-120vh) rotate(0deg)}100%{transform:translateY(120vh) rotate(720deg)}}
  @keyframes sparkle{0%,100%{opacity:.2;transform:scale(.95)}50%{opacity:1;transform:scale(1.15)}}
  @keyframes flutter{0%{transform:translate(-50%,-50%) rotate(0) scale(1)}50%{transform:translate(-30%,-65%) rotate(10deg) scale(1.2)}100%{transform:translate(60%,-40%) rotate(-5deg) scale(1)}}
  @keyframes lick{0%{transform:translateY(0)}30%{transform:translateY(-4px)}60%{transform:translateY(2px)}100%{transform:translateY(0)}}
  @keyframes drift{0%{transform:translate(-120%,40px) rotate(-10deg)}40%{transform:translate(0%,0) rotate(0deg)}65%{transform:translate(25%,-8px) rotate(3deg)}100%{transform:translate(120%,20px) rotate(2deg)}}
  .shadow{filter:drop-shadow(0 10px 18px rgba(0,0,0,.35))}
  .btn{display:inline-flex;align-items:center;gap:8px;background:var(--brand);color:#fff;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--brand);border:1px solid var(--brand)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

  /* Bottom nav */
  nav.bottom{
    position:fixed;inset:auto 0 0 0;height:82px;background:rgba(16,16,20,.85);backdrop-filter:blur(8px);
    border-top:1px solid rgba(255,255,255,.08);display:flex;justify-content:space-around;align-items:center;z-index:40
  }
  nav .nav-btn{display:flex;flex-direction:column;align-items:center;gap:6px;color:var(--muted);font-size:.82rem}
  nav .nav-btn.active{color:#fff}
  nav .nav-btn .ico{font-size:20px}
  .honeypot{
    position:absolute;left:50%;transform:translateX(-50%);bottom:24px;width:92px;height:92px;border-radius:50%;
    display:grid;place-items:center;background:radial-gradient(60% 60% at 50% 40%, #ffd166, #ff9f1a);box-shadow:0 12px 30px rgba(255,179,0,.35);
    border:6px solid rgba(255,255,255,.2);z-index:41
  }
  .honeypot .jar{font-size:34px;filter:drop-shadow(0 4px 10px rgba(0,0,0,.4))}
  .honeypot:active{transform:translateX(-50%) scale(.98)}

  /* Toasts / banner */
  .toast{position:fixed;left:50%;top:10px;transform:translateX(-50%);background:#111c;border:1px solid rgba(255,255,255,.12);padding:10px 12px;border-radius:10px;z-index:60}
  .toast.bad{background:#2b0d0d;color:#fff;border-color:#ff4d4d}
  .toast.ok{background:#0e2a1f;border-color:#34d399}
  .console{background:#000c;color:#d9e3ff;border-radius:10px;padding:10px;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-size:.86rem}
  .link{color:#9abaff;text-decoration:underline;cursor:pointer}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo"></div>
    <div>
      <div class="brand">BuzzPi</div>
      <div class="tabs" id="homeTabs">
        <div class="chip active">Following</div>
        <div class="chip">Popular</div>
        <div class="chip">Nearby</div>
        <div class="chip">New</div>
      </div>
    </div>
    <div style="margin-left:auto;font-weight:800" id="balance">0</div>
  </header>

  <!-- Screens -->
  <section class="screen active" id="scrHome">
    <div class="card">
      <div style="font-weight:800">Welcome üëã</div>
      <div class="muted small">This is a lightweight sandbox to try BuzzCoin gifts and FX. Tap <b>Gifts</b> below to play.</div>
    </div>
    <div class="card">
      <div style="font-weight:800;margin-bottom:8px">If anything looks cached</div>
      <div class="muted small">Hard-refresh with <span class="link" id="forceReload">?v=<span id="vNum">10</span></span>.</div>
    </div>
  </section>

  <section class="screen" id="scrGifts">
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div>
          <div style="font-weight:800">Gifts</div>
          <div class="muted small">Tap to send. Long-press for rapid combo.</div>
        </div>
        <div class="row">
          <button class="btn ghost" id="watchAd">Watch ad (+1)</button>
          <button class="btn ghost" id="devAdd">Dev +50</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="tabs" id="giftTabs">
        <div class="chip active" data-cat="common">Common</div>
        <div class="chip" data-cat="rare">Rare</div>
        <div class="chip" data-cat="billion">Billionaire</div>
      </div>

      <div id="giftWrap" style="margin-top:12px"></div>
    </div>

    <div class="card">
      <div style="font-weight:800">Console</div>
      <div class="console" id="log">Ready.</div>
    </div>
  </section>

  <section class="screen" id="scrWallet">
    <div class="card">
      <div style="font-weight:800">Wallet</div>
      <div class="muted small">This demo wallet only tracks local BuzzCoin for testing gifts.</div>
    </div>
    <div class="card">
      <div class="row">
        <button class="btn" id="devAdd100">Dev +100</button>
        <button class="btn ghost" id="devReset">Reset balance</button>
      </div>
    </div>
  </section>

  <section class="screen" id="scrProfile">
    <div class="card">
      <div style="font-weight:800">Profile</div>
      <div class="muted small">Placeholder ‚Äî we‚Äôll wire this to real accounts later.</div>
    </div>
  </section>

  <!-- FX overlay -->
  <div class="fx-layer" id="fx"></div>

  <!-- Bottom nav -->
  <nav class="bottom">
    <button class="nav-btn" data-target="scrHome"><div class="ico">üè†</div>Home</button>
    <button class="nav-btn" data-target="scrGifts"><div class="ico">üéÅ</div>Gifts</button>

    <button class="honeypot" id="goLive" title="Go Live (mock)">
      <div class="jar">üçØ</div>
    </button>

    <button class="nav-btn" data-target="scrWallet"><div class="ico">üí∞</div>Wallet</button>
    <button class="nav-btn" data-target="scrProfile"><div class="ico">üë§</div>Profile</button>
  </nav>
</div>

<!-- Toast -->
<div class="toast" id="toast" style="display:none"></div>

<script>
/* ----------------------- tiny helpers ----------------------- */
const $ = sel => document.querySelector(sel);
const el = id => document.getElementById(id);
const log = (...a)=>{ const L=el('log'); L.textContent = a.join(' '); L.scrollTop=L.scrollHeight; };
const toast = (msg,type='ok',ms=1800)=>{
  const t = el('toast'); t.className = 'toast '+type; t.textContent = msg; t.style.display='block';
  clearTimeout(t._h); t._h=setTimeout(()=>t.style.display='none',ms);
};

/* ----------------------- state ----------------------- */
const STATE = {
  balance: 300,                    // start with some coins
  ad: {max:5, cooldown:5, count:0, last:0},   // per day
  holdTimer: null,
  selectedGift: null,
};

const EL = {
  screens: {
    scrHome: el('scrHome'),
    scrGifts: el('scrGifts'),
    scrWallet: el('scrWallet'),
    scrProfile: el('scrProfile'),
  },
  fx: el('fx'),
  giftWrap: el('giftWrap'),
  balance: el('balance')
};

/* ----------------------- null-safe screen switch ----------------------- */
function show(id){
  const screens = Object.values(EL.screens).filter(Boolean);
  screens.forEach(s=>s.classList.remove('active'));
  const target = EL.screens[id];
  if (target) target.classList.add('active');
  // update nav state
  document.querySelectorAll('nav .nav-btn').forEach(b=>{
    b.classList.toggle('active', b.dataset.target===id);
  });
}

document.querySelectorAll('nav .nav-btn').forEach(b=>{
  b.addEventListener('click', ()=> show(b.dataset.target));
});
el('forceReload').addEventListener('click', ()=>{
  const v = Number(el('vNum').textContent||10)+1;
  location.href = location.origin + '/?v='+v;
});

/* ----------------------- balance ----------------------- */
function fmt(n){ return n.toLocaleString(); }
function updateBalance(){ EL.balance.textContent = fmt(STATE.balance); }
updateBalance();

/* ----------------------- gifts catalog ----------------------- */
const CATALOG = {
  common: [
    {id:'party', emo:'ü•≥', name:'Party', price:1},
    {id:'hearts', emo:'ü•∞', name:'Hearts', price:1},
    {id:'love', emo:'üòç', name:'Love', price:1},
    {id:'yum', emo:'üòã', name:'Yum', price:1},
    {id:'hug', emo:'ü§ó', name:'Hug', price:1},
    {id:'starry', emo:'ü§©', name:'Starry', price:1},
    {id:'rich', emo:'ü§ë', name:'Making it', price:1},
    {id:'lolly', emo:'üç≠', name:'Lolly', price:2},
    {id:'candy', emo:'üç¨', name:'Candy', price:2},
    {id:'choc', emo:'üç´', name:'Choco', price:2},
    {id:'martini', emo:'üç∏', name:'Martini', price:5},
    {id:'apple', emo:'üçé', name:'Apple', price:5},
    {id:'beer', emo:'üç∫', name:'Beer', price:5},
    {id:'rose', emo:'üåπ', name:'Rose', price:10},
    {id:'sakura', emo:'üå∏', name:'Sakura', price:10},
    {id:'sparkle', emo:'‚ú®Ô∏è', name:'Sparkles', price:10},
    {id:'bouquet', emo:'üíê', name:'Bouquet', price:20},
    {id:'cheers', emo:'üçª', name:'Cheers', price:20},
    {id:'clap', emo:'üëè', name:'Clap', price:20},
    {id:'kiss', emo:'üíã', name:'Kiss', price:20},
  ],
  rare: [
    {id:'butterfly', emo:'ü¶ã', name:'Butterfly', price:50},
    {id:'storm', emo:'üå©', name:'Storm', price:50},
    {id:'sun', emo:'üå§', name:'Sunbeam', price:50},
    {id:'rainbow', emo:'üåà', name:'Rainbow', price:50},
    {id:'snow', emo:'‚ùÑÔ∏è', name:'Snow', price:50},
    {id:'teddy', emo:'üß∏', name:'Teddy', price:100},
    {id:'bunny', emo:'üêá', name:'Bunny', price:100},
    {id:'champ', emo:'üçæ', name:'Champagne', price:100},
    {id:'crown', emo:'üëë', name:'Crown', price:100},
    {id:'wine', emo:'üç∑', name:'Wine', price:100},
    {id:'flutes', emo:'ü•Ç', name:'Flutes', price:100},
    {id:'jadeLambo', emo:'üöó', name:'Jade Lamborghini', price:500},
    {id:'crystalPlane', emo:'‚úàÔ∏è', name:'Crystal Aeroplane', price:500},
    {id:'goldHummer', emo:'üöô', name:'Golden Hummer', price:500},
    {id:'yacht', emo:'üõ•Ô∏è', name:'Yacht', price:500},
  ],
  billion: [
    {id:'phoenix', emo:'üî•', name:'Fiery Phoenix', price:1000},
    {id:'unicorn', emo:'ü¶Ñ', name:'Racing Unicorn', price:1000},
    {id:'castle', emo:'üè∞', name:'Crystal Castle', price:1000},
    {id:'treasure', emo:'ü™ô', name:'Pirate Chest', price:1000},
    {id:'skyMansion', emo:'üèôÔ∏è', name:'Mansion in the Sky', price:5000},
    {id:'mermaid', emo:'üßú‚Äç‚ôÄÔ∏è', name:'Mermaid', price:5000},
    {id:'cupids', emo:'üèπ', name:'Cupids', price:5000},
    {id:'elfQueen', emo:'üëë', name:'Elf Queen', price:5000},
    {id:'goldJet', emo:'üõ©Ô∏è', name:'Golden Private Jet', price:10000},
    {id:'rolex', emo:'‚åö', name:'Diamond Rolex', price:10000},
    {id:'chariots', emo:'üêé', name:'Chariots of Horses', price:10000},
  ]
};

/* ----------------------- render catalog ----------------------- */
function renderCategory(cat){
  const wrap = document.createElement('div');
  wrap.className='gift-grid';
  CATALOG[cat].forEach(g=>{
    const d=document.createElement('div');
    d.className='gift';
    d.dataset.id=g.id; d.dataset.price=g.price; d.dataset.cat=cat;
    d.innerHTML=`<div class="emo">${g.emo}</div><div class="name">${g.name}</div><div class="price">${g.price}</div>`;
    // select highlight
    d.addEventListener('click', ()=>{
      document.querySelectorAll('.gift').forEach(x=>x.classList.remove('selected'));
      d.classList.add('selected');
      STATE.selectedGift = g;
      sendGift(g); // single tap sends once
    });
    // long press for combo
    let pressT;
    d.addEventListener('pointerdown', ()=>{
      pressT=setTimeout(()=>{ // start auto send after 350ms hold
        STATE.holdTimer=setInterval(()=> sendGift(g,true), 280);
      }, 350);
    });
    const stopHold=()=>{ clearTimeout(pressT); if(STATE.holdTimer){clearInterval(STATE.holdTimer); STATE.holdTimer=null;} };
    d.addEventListener('pointerup',stopHold); d.addEventListener('pointerleave',stopHold); d.addEventListener('pointercancel',stopHold);
    wrap.appendChild(d);
  });
  EL.giftWrap.innerHTML='';
  EL.giftWrap.appendChild(wrap);
}
renderCategory('common');

el('giftTabs').addEventListener('click', (e)=>{
  const chip = e.target.closest('.chip'); if(!chip) return;
  el('giftTabs').querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  chip.classList.add('active');
  renderCategory(chip.dataset.cat);
});

/* ----------------------- ads (1 coin, max 5/day, 5s cooldown) ----------------------- */
function todayKey(){ const d=new Date(); return `ad-${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`; }
function loadAdState(){
  const k=todayKey(); const obj=JSON.parse(localStorage.getItem(k)||'{"count":0,"last":0}');
  STATE.ad.count=obj.count||0; STATE.ad.last=obj.last||0;
}
function saveAdState(){
  const k=todayKey(); localStorage.setItem(k, JSON.stringify({count:STATE.ad.count,last:STATE.ad.last}));
}
loadAdState();

el('watchAd').addEventListener('click', ()=>{
  const now=Date.now()/1000;
  if(STATE.ad.count>=STATE.ad.max){ toast("Daily ad limit reached (5).", "bad"); return; }
  if(now-STATE.ad.last<STATE.ad.cooldown){ toast(`Please wait ${Math.ceil(STATE.ad.cooldown-(now-STATE.ad.last))}s‚Ä¶`,"warn"); return; }
  // simulate a 5s ad
  toast("Playing ad‚Ä¶ (+1)", "ok", 1200);
  STATE.ad.last=now; STATE.ad.count++; saveAdState();
  setTimeout(()=>{ STATE.balance+=1; updateBalance(); toast("1 BuzzCoin added!","ok"); }, 500);
});

el('devAdd').addEventListener('click', ()=>{ STATE.balance+=50; updateBalance(); toast("+50 test coins","ok"); });
el('devAdd100').addEventListener('click', ()=>{ STATE.balance+=100; updateBalance(); toast("+100","ok"); });
el('devReset').addEventListener('click', ()=>{ STATE.balance=0; updateBalance(); toast("Balance reset","warn"); });

/* ----------------------- send gift ----------------------- */
function spend(n){
  if(STATE.balance<n){ toast("Not enough BuzzCoin","bad"); return false; }
  STATE.balance-=n; updateBalance(); return true;
}

function sendGift(g, combo=false){
  if(!spend(g.price)) return;
  animateGift(g, combo);
  log(`Sent ${g.name} (‚àí${g.price}). Balance ${STATE.balance}.`);
}

/* ----------------------- FX primitives ----------------------- */
function addFx(html, opts={}){
  const n=document.createElement('div'); n.className='fx-item shadow';
  n.innerHTML=html;
  if(opts.style) Object.assign(n.style, opts.style);
  EL.fx.appendChild(n);
  const kill=()=>n.remove();
  const ms = (opts.ms??5000);
  setTimeout(kill, ms);
  return n;
}
function lensTint(color='rgba(255,180,80,.25)', ms=800){
  const n=document.createElement('div'); n.style.cssText=`position:absolute;inset:0;background:${color};mix-blend-mode:screen;opacity:.0`;
  EL.fx.appendChild(n);
  n.animate([{opacity:0},{opacity:1},{opacity:0}], {duration:ms, easing:'ease-in-out'}).onfinish=()=>n.remove();
}
function confetti(ms=1200){
  for(let i=0;i<30;i++){
    const s=document.createElement('div'); s.style.cssText=`position:absolute;left:${Math.random()*100}%;top:-10vh;width:6px;height:10px;background:hsl(${Math.random()*360} 90% 60%);animation:confettiFall ${ms}ms linear forwards;`;
    EL.fx.appendChild(s); setTimeout(()=>s.remove(), ms+200);
  }
}

/* ----------------------- Alive behaviors ----------------------- */
function animateGift(g, combo){
  const heavy = g.price>=1000;
  const dur = heavy ? 8000 : g.price>=500 ? 6000 : 5000;

  switch(g.id){
    /* === Common examples === */
    case 'party': {
      confetti(1600);
      const face = addFx(`<div style="font-size:72px">ü•≥</div>`, {ms:1600});
      // party blower tongue roll
      face.animate([
        {transform:'translate(-50%,-50%) scale(1)'},
        {transform:'translate(-50%,-48%) scale(1.15)'},
        {transform:'translate(-50%,-50%) scale(1)'}],
        {duration:1400, easing:'ease-in-out'});
      break;
    }
    case 'yum': {
      const n=addFx(`<div style="font-size:84px">üòã</div>`, {ms:1500});
      n.animate([{transform:'translate(-50%,-50%)'},{transform:'translate(-50%,-53%)'},{transform:'translate(-50%,-50%)'}],
                {duration:1200,easing:'ease-in-out'});
      break;
    }

    /* === Rare === */
    case 'butterfly': {
      const n=addFx(`<div style="font-size:70px">ü¶ã</div>`, {ms:dur});
      n.style.animation='flutter 5200ms ease-in-out forwards';
      const shimmer=addFx(`<div style="width:220px;height:220px;border-radius:50%;box-shadow:0 0 60px 10px rgba(147,197,253,.35) inset"></div>`, {ms:1200,style:{opacity:.6}});
      shimmer.animate([{opacity:.0, transform:'translate(-50%,-50%) scale(.6)'},{opacity:.6,transform:'translate(-50%,-50%) scale(1)'},{opacity:0,transform:'translate(-50%,-50%) scale(1.2)'}],
                      {duration:1200});
      break;
    }
    case 'goldHummer': {
      const car=addFx(`<div style="font-size:72px;filter:drop-shadow(0 14px 20px rgba(0,0,0,.5))">üöô</div>`, {ms:dur, style:{bottom:'12%', left:'-10%'}});
      car.style.top='auto'; car.style.transform='translate(0,0)';
      car.animate([{transform:'translate(-10vw,0) rotate(-8deg)'},{transform:'translate(40vw,-2vh) rotate(2deg)'},{transform:'translate(110vw,1.5vh) rotate(3deg)'}],
                  {duration:5200, easing:'cubic-bezier(.25,.8,.2,1)'});
      // tire smoke puffs
      for(let i=0;i<12;i++){
        const puff=addFx(`<div style="width:26px;height:26px;border-radius:50%;background:radial-gradient(circle,#fff8,transparent 60%)"></div>`,{ms:1600,style:{left: '35%', bottom:'12%'}});
        puff.style.top='auto';
        puff.animate([{transform:'translate(0,0) scale(.6)',opacity:.7},{transform:'translate(20px,-40px) scale(1.4)',opacity:0}],
                     {duration:1200,delay:i*120});
      }
      break;
    }

    /* === Billionaire highlights === */
    case 'phoenix': {
      // mini interpreter for your JSON
      const script = {
        id:"gift.phoenix_rebirth", duration:8000,
        beats:[
          {t:0,   actions:['grade:warm_in','bloom:0.4']},
          {t:600, actions:['ignite_sigil','sparks']},
          {t:2200,actions:['phoenix_enter']},
          {t:4200,actions:['phoenix_crown','banner']},
          {t:6000,actions:['embers_tail','grade:neutral']},
        ]
      };
      runPhoenix(script);
      break;
    }
    case 'unicorn': {
      lensTint('rgba(255,255,255,.18)', 1600);
      const n=addFx(`<div style="font-size:100px">ü¶Ñ</div>`, {ms:dur});
      n.animate([{transform:'translate(-60vw,30vh) scale(1.2) rotate(-12deg)'},
                 {transform:'translate(0,0) scale(1) rotate(0deg)'},
                 {transform:'translate(60vw,-20vh) scale(1.1) rotate(6deg)'}],
                {duration:6200, easing:'ease-in-out'});
      // stardust trail
      for(let i=0;i<40;i++){
        const s=addFx(`<div style="width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.9)"></div>`, {ms:2000});
        s.animate([{transform:`translate(${-300+Math.random()*100}px, ${120-Math.random()*40}px)`, opacity:.0},
                   {transform:'translate(0,0)', opacity:1},
                   {transform:`translate(${200+Math.random()*120}px, ${-120+Math.random()*40}px)`, opacity:0}],
                  {duration:1800, delay:i*40});
      }
      break;
    }
    default:{
      // generic pop & sparkle
      const n=addFx(`<div style="font-size:${heavy?96:g.price>=500?84:64}px">${g.emo}</div>`, {ms:dur});
      n.animate([{transform:'translate(-50%,-40%) scale(.9)'},{transform:'translate(-50%,-50%) scale(1.2)'},{transform:'translate(-50%,-55%) scale(1)'}],
                {duration:1400,easing:'ease-in-out'});
      for(let i=0;i<10;i++){
        const star=addFx(`<div style="width:8px;height:8px;border-radius:50%;background:#fff"></div>`, {ms:1200});
        star.animate([{transform:`translate(${(Math.random()*2-1)*80}px, ${(Math.random()*2-1)*60}px)`, opacity:1},
                      {transform:`translate(${(Math.random()*2-1)*140}px, ${(Math.random()*2-1)*120}px)`, opacity:0}],
                     {duration:1000, delay:i*60});
      }
    }
  }
}

/* ---- Phoenix JSON runner (lightweight mapping to DOM actions) ---- */
function runPhoenix(cfg){
  const start=performance.now();
  const overlay=document.createElement('div');
  overlay.style.cssText='position:absolute;inset:0;background:transparent';
  EL.fx.appendChild(overlay);

  const timers=[];
  function act(a){
    if(a.startsWith('grade:warm_in')) overlay.animate([{background:'transparent'},{background:'radial-gradient(120% 120% at 50% 50%, rgba(255,120,40,.20), transparent 60%)'}],{duration:900,fill:'forwards'});
    if(a.startsWith('bloom')) lensTint('rgba(255,180,80,.22)',900);
    if(a==='ignite_sigil'){
      const s=addFx(`<div style="width:160px;height:160px;border:3px solid rgba(255,120,0,.8);border-radius:50%"></div>`,{ms:1600});
      s.animate([{transform:'translate(-50%,-50%) scale(.6)',opacity:.2},{transform:'translate(-50%,-50%) scale(1.2)',opacity:1},{opacity:0}],{duration:1400});
    }
    if(a==='sparks'){
      for(let i=0;i<40;i++){
        const p=addFx(`<div style="width:4px;height:4px;border-radius:50%;background:rgba(255,200,120,.95)"></div>`,{ms:1200});
        p.animate([{transform:'translate(0,0)',opacity:1},{transform:`translate(${(Math.random()*2-1)*140}px, ${(Math.random()*-1)*160}px)`,opacity:0}],{duration:1200});
      }
    }
    if(a==='phoenix_enter'){
      const fx=addFx(`<div style="font-size:110px">üî•</div>`,{ms:3000});
      fx.animate([{transform:'translate(-50%,40vh) scale(.8)'},{transform:'translate(-50%,-10vh) scale(1.2)'},{transform:'translate(-50%,-50%) scale(1)'}],
                 {duration:2400, easing:'ease-out'});
    }
    if(a==='phoenix_crown'){
      const ring=addFx(`<div style="width:220px;height:220px;border-radius:50%;box-shadow:0 0 120px 40px rgba(255,190,120,.45) inset"></div>`,{ms:1400});
      ring.animate([{transform:'translate(-50%,-50%) scale(.6)',opacity:.2},{transform:'translate(-50%,-50%) scale(1.1)',opacity:.9},{opacity:0}],{duration:1200});
    }
    if(a==='banner'){
      const b=addFx(`<div style="padding:10px 16px;border-radius:12px;background:linear-gradient(90deg,#ff9f1a,#ffd166);color:#000;font-weight:800">Phoenix Rebirth!</div>`,{ms:1800,style:{top:'12%',left:'50%'}});
      b.animate([{transform:'translate(-50%,-120%)',opacity:0},{transform:'translate(-50%,0)',opacity:1},{transform:'translate(-50%,-120%)',opacity:0}],{duration:1800});
    }
    if(a==='embers_tail'){
      for(let i=0;i<30;i++){
        const e=addFx(`<div style="width:6px;height:6px;border-radius:50%;background:rgba(255,120,0,.9)"></div>`,{ms:1600});
        e.animate([{transform:`translate(${Math.random()*80-40}px, ${Math.random()*20-10}px)`,opacity:1},{transform:`translate(${Math.random()*120-60}px, ${80+Math.random()*60}px)`,opacity:0}],{duration:1500, delay:i*30});
      }
    }
    if(a==='grade:neutral') overlay.animate([{background:overlay.style.background||'transparent'},{background:'transparent'}],{duration:800});
  }

  cfg.beats.forEach(b=>{
    timers.push(setTimeout(()=>{ b.actions.forEach(act); }, b.t));
  });
  timers.push(setTimeout(()=>overlay.remove(), cfg.duration||8000));
}

/* ----------------------- mock live button ----------------------- */
el('goLive').addEventListener('click', ()=> toast("Mock: Start Live not wired in demo", "warn"));

/* ----------------------- global error banner ----------------------- */
window.addEventListener('error', e=>{
  toast("JS error: "+(e.message||'Unknown'), 'bad', 2600);
});

/* default nav */
show('scrHome');
</script>
</body>
</html>